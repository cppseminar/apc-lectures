<!DOCTYPE html><html lang="C"><head><title>Korutiny</title><meta property="og:title" content="Korutiny"><meta charset="UTF-8"><meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0"><meta name="apple-mobile-web-app-capable" content="yes"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta property="og:type" content="website"><meta name="twitter:card" content="summary"><style>@media screen{body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container button{-webkit-tap-highlight-color:transparent;-webkit-appearance:none;appearance:none;background-color:transparent;border:0;color:inherit;cursor:pointer;font-size:inherit;opacity:.8;outline:none;padding:0;transition:opacity .2s linear}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button:disabled,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button:disabled,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button:disabled,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container button:disabled{cursor:not-allowed;opacity:.15!important}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button:hover,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button:hover,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button:hover,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container button:hover{opacity:1}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button:hover:active,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button:hover:active,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button:hover:active,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container button:hover:active{opacity:.6}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button:hover:not(:disabled),body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button:hover:not(:disabled),body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button:hover:not(:disabled),body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container button:hover:not(:disabled){transition:none}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=prev],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=prev],body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button.bespoke-marp-presenter-info-page-prev{background:transparent url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiNmZmYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSI1IiBkPSJNNjggOTAgMjggNTBsNDAtNDAiLz48L3N2Zz4=") no-repeat 50%;background-size:contain;overflow:hidden;text-indent:100%;white-space:nowrap}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=next],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=next],body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button.bespoke-marp-presenter-info-page-next{background:transparent url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiNmZmYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSI1IiBkPSJtMzIgOTAgNDAtNDAtNDAtNDAiLz48L3N2Zz4=") no-repeat 50%;background-size:contain;overflow:hidden;text-indent:100%;white-space:nowrap}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=fullscreen],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=fullscreen]{background:transparent url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48ZGVmcz48c3R5bGU+LmF7ZmlsbDpub25lO3N0cm9rZTojZmZmO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2Utd2lkdGg6NXB4fTwvc3R5bGU+PC9kZWZzPjxyZWN0IGNsYXNzPSJhIiB4PSIxMCIgeT0iMjAiIHdpZHRoPSI4MCIgaGVpZ2h0PSI2MCIgcng9IjUuNjciLz48cGF0aCBjbGFzcz0iYSIgZD0iTTQwIDcwSDIwVjUwbTIwIDBMMjAgNzBtNDAtNDBoMjB2MjBtLTIwIDAgMjAtMjAiLz48L3N2Zz4=") no-repeat 50%;background-size:contain;overflow:hidden;text-indent:100%;white-space:nowrap}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button.exit[data-bespoke-marp-osc=fullscreen],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button.exit[data-bespoke-marp-osc=fullscreen]{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48ZGVmcz48c3R5bGU+LmF7ZmlsbDpub25lO3N0cm9rZTojZmZmO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2Utd2lkdGg6NXB4fTwvc3R5bGU+PC9kZWZzPjxyZWN0IGNsYXNzPSJhIiB4PSIxMCIgeT0iMjAiIHdpZHRoPSI4MCIgaGVpZ2h0PSI2MCIgcng9IjUuNjciLz48cGF0aCBjbGFzcz0iYSIgZD0iTTIwIDUwaDIwdjIwbS0yMCAwIDIwLTIwbTQwIDBINjBWMzBtMjAgMEw2MCA1MCIvPjwvc3ZnPg==")}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=presenter],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=presenter]{background:transparent url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBkPSJNODcuOCA0Ny41Qzg5IDUwIDg3LjcgNTIgODUgNTJIMzVhOC43IDguNyAwIDAgMS03LjItNC41bC0xNS42LTMxQzExIDE0IDEyLjIgMTIgMTUgMTJoNTBhOC44IDguOCAwIDAgMSA3LjIgNC41ek02MCA1MnYzNm0tMTAgMGgyME00NSA0MmgyMCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjZmZmIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHN0cm9rZS13aWR0aD0iNSIvPjwvc3ZnPg==") no-repeat 50%;background-size:contain;overflow:hidden;text-indent:100%;white-space:nowrap}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container button.bespoke-marp-presenter-note-bigger{background:transparent url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBkPSJNMTIgNTBoODBNNTIgOTBWMTAiIHN0cm9rZT0iI2ZmZiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBzdHJva2Utd2lkdGg9IjUiLz48L3N2Zz4=") no-repeat 50%;background-size:contain;overflow:hidden;text-indent:100%;white-space:nowrap}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container button.bespoke-marp-presenter-note-smaller{background:transparent url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBkPSJNMTIgNTBoODAiIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2ZmZiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBzdHJva2Utd2lkdGg9IjUiLz48L3N2Zz4=") no-repeat 50%;background-size:contain;overflow:hidden;text-indent:100%;white-space:nowrap}}@keyframes __bespoke_marp_transition_reduced_outgoing__{0%{opacity:1}to{opacity:0}}@keyframes __bespoke_marp_transition_reduced_incoming__{0%{mix-blend-mode:plus-lighter;opacity:0}to{mix-blend-mode:plus-lighter;opacity:1}}.bespoke-marp-note,.bespoke-marp-osc,.bespoke-progress-parent{display:none;transition:none}@media screen{::page-transition-container(*){animation-duration:var(--marp-bespoke-transition-animation-duration,.5s);animation-timing-function:ease}::page-transition-incoming-image(*),::page-transition-outgoing-image(*){animation-delay:0s;animation-direction:var(--marp-bespoke-transition-animation-direction,normal);animation-duration:var(--marp-bespoke-transition-animation-duration,.5s);animation-fill-mode:both;animation-name:var(--marp-bespoke-transition-animation-name,var(--marp-bespoke-transition-animation-name-fallback,__bespoke_marp_transition_no_animation__));mix-blend-mode:normal}::page-transition-outgoing-image(*){--marp-bespoke-transition-animation-name-fallback:__bespoke_marp_transition_reduced_outgoing__;animation-timing-function:ease}::page-transition-incoming-image(*){--marp-bespoke-transition-animation-name-fallback:__bespoke_marp_transition_reduced_incoming__;animation-timing-function:ease}::page-transition-incoming-image(root),::page-transition-outgoing-image(root){animation-timing-function:linear}::page-transition-incoming-image(__bespoke_marp_transition_osc__),::page-transition-outgoing-image(__bespoke_marp_transition_osc__){animation-duration:0s!important;animation-name:__bespoke_marp_transition_osc__!important}::page-transition-incoming-image(__bespoke_marp_transition_osc__){opacity:0!important}.bespoke-marp-transition-warming-up::page-transition-container(*),.bespoke-marp-transition-warming-up::page-transition-incoming-image(*),.bespoke-marp-transition-warming-up::page-transition-outgoing-image(*){animation-play-state:paused!important}body,html{height:100%;margin:0}body{background:#000;overflow:hidden}svg.bespoke-marp-slide{content-visibility:hidden;opacity:0;pointer-events:none;z-index:-1}svg.bespoke-marp-slide:not(.bespoke-marp-active) *{page-transition-tag:none!important}svg.bespoke-marp-slide.bespoke-marp-active{content-visibility:visible;opacity:1;pointer-events:auto;z-index:0}svg.bespoke-marp-slide.bespoke-marp-active.bespoke-marp-active-ready *{animation-name:__bespoke_marp__!important}@supports not (content-visibility:hidden){svg.bespoke-marp-slide[data-bespoke-marp-load=hideable]{display:none}svg.bespoke-marp-slide[data-bespoke-marp-load=hideable].bespoke-marp-active{display:block}}}@media screen and (prefers-reduced-motion:reduce){svg.bespoke-marp-slide *{page-transition-tag:none!important}}@media screen{[data-bespoke-marp-fragment=inactive]{visibility:hidden}body[data-bespoke-view=""] .bespoke-marp-parent,body[data-bespoke-view=next] .bespoke-marp-parent{bottom:0;left:0;position:absolute;right:0;top:0}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc{page-transition-tag:__bespoke_marp_transition_osc__;background:rgba(0,0,0,.65);border-radius:7px;bottom:50px;color:#fff;contain:paint;display:block;font-family:Helvetica,Arial,sans-serif;font-size:16px;left:50%;line-height:0;opacity:1;padding:12px;position:absolute;touch-action:manipulation;transform:translateX(-50%);transition:opacity .2s linear;-webkit-user-select:none;user-select:none;white-space:nowrap;will-change:transform;z-index:1}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>*,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>*{margin-left:6px}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>:first-child,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>:first-child{margin-left:0}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>span,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>span{opacity:.8}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>span[data-bespoke-marp-osc=page],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>span[data-bespoke-marp-osc=page]{display:inline-block;min-width:140px;text-align:center}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=fullscreen],body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=next],body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=presenter],body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=prev],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=fullscreen],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=next],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=presenter],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=prev]{height:32px;line-height:32px;width:32px}body[data-bespoke-view=""] .bespoke-marp-parent.bespoke-marp-inactive,body[data-bespoke-view=next] .bespoke-marp-parent.bespoke-marp-inactive{cursor:none}body[data-bespoke-view=""] .bespoke-marp-parent.bespoke-marp-inactive>.bespoke-marp-osc,body[data-bespoke-view=next] .bespoke-marp-parent.bespoke-marp-inactive>.bespoke-marp-osc{opacity:0;pointer-events:none}body[data-bespoke-view=""] svg.bespoke-marp-slide,body[data-bespoke-view=next] svg.bespoke-marp-slide{height:100%;left:0;position:absolute;top:0;width:100%}body[data-bespoke-view=""] .bespoke-progress-parent{background:#222;display:flex;height:5px;width:100%}body[data-bespoke-view=""] .bespoke-progress-parent+.bespoke-marp-parent{top:5px}body[data-bespoke-view=""] .bespoke-progress-parent .bespoke-progress-bar{background:#0288d1;flex:0 0 0;transition:flex-basis .2s cubic-bezier(0,1,1,1)}body[data-bespoke-view=next]{background:transparent}body[data-bespoke-view=presenter]{background:#161616}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container{display:grid;font-family:Helvetica,Arial,sans-serif;grid-template:"current dragbar next" minmax(140px,1fr) "current dragbar note" 2fr "info    dragbar note" 3em;grid-template-columns:minmax(3px,var(--bespoke-marp-presenter-split-ratio,66%)) 0 minmax(3px,1fr);height:100%;left:0;position:absolute;top:0;width:100%}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-parent{grid-area:current;overflow:hidden;position:relative}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-parent svg.bespoke-marp-slide{height:calc(100% - 40px);left:20px;pointer-events:none;position:absolute;top:20px;-webkit-user-select:none;user-select:none;width:calc(100% - 40px)}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-parent svg.bespoke-marp-slide.bespoke-marp-active{filter:drop-shadow(0 3px 10px rgba(0,0,0,.5))}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-dragbar-container{background:#0288d1;cursor:col-resize;grid-area:dragbar;margin-left:-3px;opacity:0;position:relative;transition:opacity .4s linear .1s;width:6px;z-index:10}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-dragbar-container:hover{opacity:1}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-dragbar-container.active{opacity:1;transition-delay:0s}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-next-container{background:#222;cursor:pointer;display:none;grid-area:next;overflow:hidden;position:relative}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-next-container.active{display:block}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-next-container iframe.bespoke-marp-presenter-next{background:transparent;border:0;display:block;filter:drop-shadow(0 3px 10px rgba(0,0,0,.5));height:calc(100% - 40px);left:20px;pointer-events:none;position:absolute;top:20px;-webkit-user-select:none;user-select:none;width:calc(100% - 40px)}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container{background:#222;color:#eee;grid-area:note;position:relative;z-index:1}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container button{height:1.5em;line-height:1.5em;width:1.5em}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-presenter-note-wrapper{bottom:0;display:block;left:0;position:absolute;right:0;top:0}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-presenter-note-buttons{background:rgba(0,0,0,.65);border-radius:4px;bottom:0;display:flex;gap:4px;margin:12px;opacity:0;padding:6px;pointer-events:none;position:absolute;right:0;transition:opacity .2s linear}}@media screen{body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-presenter-note-buttons:focus-within,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-presenter-note-wrapper:focus-within+.bespoke-marp-presenter-note-buttons,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container:hover .bespoke-marp-presenter-note-buttons{opacity:1;pointer-events:auto}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note{word-wrap:break-word;box-sizing:border-box;font-size:calc(1.1em*var(--bespoke-marp-note-font-scale, 1));height:calc(100% - 40px);margin:20px;overflow:auto;padding-right:3px;scrollbar-color:hsla(0,0%,93%,.5) transparent;scrollbar-width:thin;white-space:pre-wrap;width:calc(100% - 40px)}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note::-webkit-scrollbar{width:6px}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note::-webkit-scrollbar-track{background:transparent}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note::-webkit-scrollbar-thumb{background:hsla(0,0%,93%,.5);border-radius:6px}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note:empty{pointer-events:none}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note.active{display:block}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note p:first-child{margin-top:0}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note p:last-child{margin-bottom:0}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container{align-items:center;box-sizing:border-box;color:#eee;display:flex;flex-wrap:nowrap;grid-area:info;justify-content:center;overflow:hidden;padding:0 10px}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-page,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-time,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-timer{box-sizing:border-box;display:block;padding:0 10px;white-space:nowrap;width:100%}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button{height:1.5em;line-height:1.5em;width:1.5em}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-page{order:2;text-align:center}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-page .bespoke-marp-presenter-info-page-text{display:inline-block;min-width:120px;text-align:center}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-time{color:#999;order:1;text-align:left}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-timer{color:#999;order:3;text-align:right}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-timer:hover{cursor:pointer}}@media print{.bespoke-marp-presenter-info-container,.bespoke-marp-presenter-next-container,.bespoke-marp-presenter-note-container{display:none}}</style><style>div#p>svg>foreignObject>section{width:1280px;height:720px;box-sizing:border-box;overflow:hidden;position:relative;scroll-snap-align:center center}div#p>svg>foreignObject>section:after{bottom:0;content:attr(data-marpit-pagination);padding:inherit;pointer-events:none;position:absolute;right:0}div#p>svg>foreignObject>section:not([data-marpit-pagination]):after{display:none}/* Normalization */div#p>svg>foreignObject>section :is(h1,marp-h1){font-size:2em;margin:0.67em 0}div#p>svg>foreignObject>section video::-webkit-media-controls{will-change:transform}@page{size:1280px 720px;margin:0}@media print{body,html{background-color:#fff;margin:0;page-break-inside:avoid;break-inside:avoid-page}div#p>svg>foreignObject>section{page-break-before:always;break-before:page}div#p>svg>foreignObject>section,div#p>svg>foreignObject>section *{-webkit-print-color-adjust:exact!important;animation-delay:0s!important;animation-duration:0s!important;color-adjust:exact!important;transition:none!important}div#p>svg[data-marpit-svg]{display:block;height:100vh;width:100vw}}div#p>svg>foreignObject>section img[data-marp-twemoji]{background:transparent;height:1em;margin:0 .05em 0 .1em;vertical-align:-.1em;width:1em}/*!
 * Marp / Marpit Uncover theme
 *
 * @theme uncover
 * @author Yuki Hattori
 *
 * @auto-scaling true
 * @size 16:9 1280px 720px
 * @size 4:3 960px 720px
 */div#p>svg>foreignObject>section{word-wrap:break-word;--color-background:#fdfcff;--color-background-code:#f2f1f4;--color-background-paginate:rgba(32,34,40,.05);--color-foreground:#202228;--color-highlight:#009dd5;--color-highlight-hover:#087eaa;--color-highlight-heading:#33b1dd;--color-header:rgba(32,34,40,.4);--color-header-shadow:rgba(253,252,255,.8);background:var(--color-background);flex-flow:column nowrap;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;font-size:40px;height:720px;justify-content:center;letter-spacing:3px;line-height:1.4;padding:30px 70px;position:relative;text-align:center;width:1280px;z-index:0}div#p>svg>foreignObject>section{--marpit-root-font-size:40px}div#p>svg>foreignObject>section,div#p>svg>foreignObject>section:after{color:var(--color-foreground);display:flex}div#p>svg>foreignObject>section:after{align-items:flex-end;background:linear-gradient(-45deg,var(--color-background-paginate) 50%,transparent 50%);background-size:cover;font-size:.6em;height:80px;justify-content:flex-end;padding:30px;text-align:right;text-shadow:0 0 5px var(--color-background);width:80px}div#p>svg>foreignObject>section:after{--marpit-root-font-size:.6em}div#p>svg>foreignObject>section:where(:not(.invert)) :is(pre,marp-pre) code.hljs{display:block;overflow-x:auto;padding:1em}div#p>svg>foreignObject>section:where(:not(.invert)) code.hljs{padding:3px 5px}div#p>svg>foreignObject>section:where(:not(.invert)) .hljs{background:#fff;color:#000}div#p>svg>foreignObject>section:where(:not(.invert)) .hljs-addition,div#p>svg>foreignObject>section:where(:not(.invert)) .hljs-meta,div#p>svg>foreignObject>section:where(:not(.invert)) .hljs-string,div#p>svg>foreignObject>section:where(:not(.invert)) .hljs-symbol,div#p>svg>foreignObject>section:where(:not(.invert)) .hljs-template-tag,div#p>svg>foreignObject>section:where(:not(.invert)) .hljs-template-variable{color:#756bb1}div#p>svg>foreignObject>section:where(:not(.invert)) .hljs-comment,div#p>svg>foreignObject>section:where(:not(.invert)) .hljs-quote{color:#636363}div#p>svg>foreignObject>section:where(:not(.invert)) .hljs-bullet,div#p>svg>foreignObject>section:where(:not(.invert)) .hljs-link,div#p>svg>foreignObject>section:where(:not(.invert)) .hljs-literal,div#p>svg>foreignObject>section:where(:not(.invert)) .hljs-number,div#p>svg>foreignObject>section:where(:not(.invert)) .hljs-regexp{color:#31a354}div#p>svg>foreignObject>section:where(:not(.invert)) .hljs-deletion,div#p>svg>foreignObject>section:where(:not(.invert)) .hljs-variable{color:#88f}div#p>svg>foreignObject>section:where(:not(.invert)) .hljs-built_in,div#p>svg>foreignObject>section:where(:not(.invert)) .hljs-doctag,div#p>svg>foreignObject>section:where(:not(.invert)) .hljs-keyword,div#p>svg>foreignObject>section:where(:not(.invert)) .hljs-name,div#p>svg>foreignObject>section:where(:not(.invert)) .hljs-section,div#p>svg>foreignObject>section:where(:not(.invert)) .hljs-selector-class,div#p>svg>foreignObject>section:where(:not(.invert)) .hljs-selector-id,div#p>svg>foreignObject>section:where(:not(.invert)) .hljs-selector-tag,div#p>svg>foreignObject>section:where(:not(.invert)) .hljs-strong,div#p>svg>foreignObject>section:where(:not(.invert)) .hljs-tag,div#p>svg>foreignObject>section:where(:not(.invert)) .hljs-title,div#p>svg>foreignObject>section:where(:not(.invert)) .hljs-type{color:#3182bd}div#p>svg>foreignObject>section:where(:not(.invert)) .hljs-emphasis{font-style:italic}div#p>svg>foreignObject>section:where(:not(.invert)) .hljs-attribute{color:#e6550d}div#p>svg>foreignObject>section:where(.invert){--color-background:#202228;--color-background-code:#2b2d33;--color-background-paginate:hsla(0,0%,100%,.05);--color-foreground:#fff;--color-highlight:#60d0f0;--color-highlight-hover:#88dcf4;--color-highlight-heading:#80d9f3;--color-header:hsla(0,0%,100%,.4);--color-header-shadow:rgba(32,34,40,.8)}div#p>svg>foreignObject>section:where(.invert) :is(pre,marp-pre) code.hljs{display:block;overflow-x:auto;padding:1em}div#p>svg>foreignObject>section:where(.invert) code.hljs{padding:3px 5px}div#p>svg>foreignObject>section:where(.invert) .hljs{background:#222;color:#fff}div#p>svg>foreignObject>section:where(.invert) .hljs-comment,div#p>svg>foreignObject>section:where(.invert) .hljs-quote{color:#777}div#p>svg>foreignObject>section:where(.invert) .hljs-built_in,div#p>svg>foreignObject>section:where(.invert) .hljs-bullet,div#p>svg>foreignObject>section:where(.invert) .hljs-deletion,div#p>svg>foreignObject>section:where(.invert) .hljs-link,div#p>svg>foreignObject>section:where(.invert) .hljs-literal,div#p>svg>foreignObject>section:where(.invert) .hljs-meta,div#p>svg>foreignObject>section:where(.invert) .hljs-number,div#p>svg>foreignObject>section:where(.invert) .hljs-params,div#p>svg>foreignObject>section:where(.invert) .hljs-regexp,div#p>svg>foreignObject>section:where(.invert) .hljs-symbol,div#p>svg>foreignObject>section:where(.invert) .hljs-tag,div#p>svg>foreignObject>section:where(.invert) .hljs-template-variable,div#p>svg>foreignObject>section:where(.invert) .hljs-variable{color:#ab875d}div#p>svg>foreignObject>section:where(.invert) .hljs-attribute,div#p>svg>foreignObject>section:where(.invert) .hljs-name,div#p>svg>foreignObject>section:where(.invert) .hljs-section,div#p>svg>foreignObject>section:where(.invert) .hljs-selector-class,div#p>svg>foreignObject>section:where(.invert) .hljs-selector-id,div#p>svg>foreignObject>section:where(.invert) .hljs-title,div#p>svg>foreignObject>section:where(.invert) .hljs-type{color:#9b869b}div#p>svg>foreignObject>section:where(.invert) .hljs-addition,div#p>svg>foreignObject>section:where(.invert) .hljs-keyword,div#p>svg>foreignObject>section:where(.invert) .hljs-selector-tag,div#p>svg>foreignObject>section:where(.invert) .hljs-string{color:#8f9c6c}div#p>svg>foreignObject>section:where(.invert) .hljs-emphasis{font-style:italic}div#p>svg>foreignObject>section:where(.invert) .hljs-strong{font-weight:700}div#p>svg>foreignObject>section>:first-child,div#p>svg>foreignObject>section[data-header]>:nth-child(2){margin-top:0}div#p>svg>foreignObject>section>:last-child,div#p>svg>foreignObject>section[data-footer]>:nth-last-child(2){margin-bottom:0}div#p>svg>foreignObject>section blockquote,div#p>svg>foreignObject>section p{margin:0 0 15px}div#p>svg>foreignObject>section :is(h1,marp-h1),div#p>svg>foreignObject>section :is(h2,marp-h2),div#p>svg>foreignObject>section :is(h3,marp-h3),div#p>svg>foreignObject>section :is(h4,marp-h4),div#p>svg>foreignObject>section :is(h5,marp-h5),div#p>svg>foreignObject>section :is(h6,marp-h6){margin:15px 0 30px}div#p>svg>foreignObject>section :is(h1,marp-h1) strong,div#p>svg>foreignObject>section :is(h2,marp-h2) strong,div#p>svg>foreignObject>section :is(h3,marp-h3) strong,div#p>svg>foreignObject>section :is(h4,marp-h4) strong,div#p>svg>foreignObject>section :is(h5,marp-h5) strong,div#p>svg>foreignObject>section :is(h6,marp-h6) strong{color:var(--color-highlight-heading);font-weight:inherit}div#p>svg>foreignObject>section :is(h1,marp-h1)::part(auto-scaling),div#p>svg>foreignObject>section :is(h2,marp-h2)::part(auto-scaling),div#p>svg>foreignObject>section :is(h3,marp-h3)::part(auto-scaling),div#p>svg>foreignObject>section :is(h4,marp-h4)::part(auto-scaling),div#p>svg>foreignObject>section :is(h5,marp-h5)::part(auto-scaling),div#p>svg>foreignObject>section :is(h6,marp-h6)::part(auto-scaling){max-height:660px}div#p>svg>foreignObject>section :is(h1,marp-h1){font-size:2em}div#p>svg>foreignObject>section :is(h2,marp-h2){font-size:1.7em}div#p>svg>foreignObject>section :is(h3,marp-h3){font-size:1.4em;letter-spacing:2px}div#p>svg>foreignObject>section :is(h4,marp-h4){font-size:1.2em;letter-spacing:2px}div#p>svg>foreignObject>section :is(h5,marp-h5){font-size:1em;letter-spacing:1px}div#p>svg>foreignObject>section :is(h6,marp-h6){font-size:.8em;letter-spacing:1px}div#p>svg>foreignObject>section footer,div#p>svg>foreignObject>section header{color:var(--color-header);font-size:.45em;left:70px;letter-spacing:1px;position:absolute;right:70px;text-shadow:0 1px 0 var(--color-header-shadow);z-index:1}div#p>svg>foreignObject>section header{top:30px}div#p>svg>foreignObject>section footer{bottom:30px}div#p>svg>foreignObject>section a{color:var(--color-highlight);text-decoration:none}div#p>svg>foreignObject>section a:hover{color:var(--color-highlight-hover);text-decoration:underline}div#p>svg>foreignObject>section ol,div#p>svg>foreignObject>section ul{margin:0 auto;text-align:left}div#p>svg>foreignObject>section>ol,div#p>svg>foreignObject>section>ul{margin-bottom:15px}div#p>svg>foreignObject>section code{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;letter-spacing:0}div#p>svg>foreignObject>section :not(:is(pre,marp-pre))>code,div#p>svg>foreignObject>section>code{background:var(--color-background-code);color:var(--color-foreground);margin:-.2em .2em .2em;padding:.2em}div#p>svg>foreignObject>section :is(pre,marp-pre){--preserve-aspect-ratio:xMidYMid meet;filter:drop-shadow(0 4px 4px rgba(0,0,0,.2));font-size:70%;line-height:1.15;margin:15px 0 30px;text-align:left}div#p>svg>foreignObject>section :is(pre,marp-pre)::part(auto-scaling){max-height:570px}div#p>svg>foreignObject>section :is(pre,marp-pre)>code{background:var(--color-background-code);box-sizing:content-box;color:var(--color-foreground);display:block;margin:0 auto;min-width:456px;padding:.4em .6em}div#p>svg>foreignObject>section[data-size="4:3"] :is(pre,marp-pre)>code{min-width:328px}div#p>svg>foreignObject>section table{border-collapse:collapse;margin:0 auto 15px}div#p>svg>foreignObject>section table>tbody>tr>td,div#p>svg>foreignObject>section table>tbody>tr>th,div#p>svg>foreignObject>section table>thead>tr>td,div#p>svg>foreignObject>section table>thead>tr>th{padding:.15em .5em}div#p>svg>foreignObject>section table>thead>tr>td,div#p>svg>foreignObject>section table>thead>tr>th{border-bottom:3px solid}div#p>svg>foreignObject>section table>tbody>tr:not(:last-child)>td,div#p>svg>foreignObject>section table>tbody>tr:not(:last-child)>th{border-bottom:1px solid}div#p>svg>foreignObject>section blockquote{font-size:90%;line-height:1.3;padding:0 2em;position:relative;z-index:0}div#p>svg>foreignObject>section blockquote:after,div#p>svg>foreignObject>section blockquote:before{content:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBkPSJNNDQgMTkuMyAzOC45NCAwQzguMTQgOS41OSAwIDQwLjA1IDAgNTQuODNWMTAwaDQxLjQ3VjU0LjgzaC0yM2MtLjA0LS4yOC4yNS0yNy42NiAyNS41My0zNS41M3ptNTYgMEw5NC45NCAwQzY0LjE0IDkuNTkgNTYgNDAuMDUgNTYgNTQuODNWMTAwaDQxLjQ3VjU0LjgzaC0yM2MtLjA0LS4yOC4yNS0yNy42NiAyNS41My0zNS41M3oiIHN0eWxlPSJmaWxsOiM4ODg7b3BhY2l0eTouMzMiLz48L3N2Zz4=");height:auto;pointer-events:none;position:absolute;width:1em;z-index:-1}div#p>svg>foreignObject>section blockquote:before{left:0;top:0}div#p>svg>foreignObject>section blockquote:after{bottom:0;right:0;transform:rotate(180deg)}div#p>svg>foreignObject>section blockquote>:last-child{margin-bottom:0}div#p>svg>foreignObject>section mark{background:transparent;color:var(--color-highlight)}div#p>svg>foreignObject>section{text-align:left;font-size:35px}div#p>svg>foreignObject>section{--marpit-root-font-size:35px}div#p>svg>foreignObject>section .small-text{text-align:right;font-size:calc(var(--marpit-root-font-size, 1rem) * 0.65)}div#p>svg>foreignObject>section section.small-text{--marpit-root-font-size:calc(var(--marpit-root-font-size, 1rem) * 0.65)}div#p>svg>foreignObject>section :is(h1,marp-h1) :is(h2,marp-h2){color:#403837}div#p>svg>foreignObject>section ul{margin-left:0}div#p>svg>foreignObject>section :is(pre,marp-pre){width:100%}div#p>svg>foreignObject>section header{padding-left:0px;font-size:25px;padding-top:0px}div#p>svg>foreignObject>section[data-marpit-scope-sTkKRn4v] .test{color:#4325;vertical-align:bottom}div#p>svg>foreignObject>section[data-marpit-advanced-background=background]{columns:initial!important;display:block!important;padding:0!important}div#p>svg>foreignObject>section[data-marpit-advanced-background=background]:after,div#p>svg>foreignObject>section[data-marpit-advanced-background=background]:before,div#p>svg>foreignObject>section[data-marpit-advanced-background=content]:after,div#p>svg>foreignObject>section[data-marpit-advanced-background=content]:before{display:none!important}div#p>svg>foreignObject>section[data-marpit-advanced-background=background]>div[data-marpit-advanced-background-container]{all:initial;display:flex;flex-direction:row;height:100%;overflow:hidden;width:100%}div#p>svg>foreignObject>section[data-marpit-advanced-background=background]>div[data-marpit-advanced-background-container][data-marpit-advanced-background-direction=vertical]{flex-direction:column}div#p>svg>foreignObject>section[data-marpit-advanced-background=background][data-marpit-advanced-background-split]>div[data-marpit-advanced-background-container]{width:var(--marpit-advanced-background-split,50%)}div#p>svg>foreignObject>section[data-marpit-advanced-background=background][data-marpit-advanced-background-split=right]>div[data-marpit-advanced-background-container]{margin-left:calc(100% - var(--marpit-advanced-background-split, 50%))}div#p>svg>foreignObject>section[data-marpit-advanced-background=background]>div[data-marpit-advanced-background-container]>figure{all:initial;background-position:center;background-repeat:no-repeat;background-size:cover;flex:auto;margin:0}div#p>svg>foreignObject>section[data-marpit-advanced-background=content],div#p>svg>foreignObject>section[data-marpit-advanced-background=pseudo]{background:transparent!important}div#p>svg>foreignObject>section[data-marpit-advanced-background=pseudo],div#p>svg[data-marpit-svg]>foreignObject[data-marpit-advanced-background=pseudo]{pointer-events:none!important}div#p>svg>foreignObject>section[data-marpit-advanced-background-split]{width:100%;height:100%}</style></head><body><div class="bespoke-marp-osc"><button data-bespoke-marp-osc="prev" tabindex="-1" title="Previous slide">Previous slide</button><span data-bespoke-marp-osc="page"></span><button data-bespoke-marp-osc="next" tabindex="-1" title="Next slide">Next slide</button><button data-bespoke-marp-osc="fullscreen" tabindex="-1" title="Toggle fullscreen (f)">Toggle fullscreen</button><button data-bespoke-marp-osc="presenter" tabindex="-1" title="Open presenter view (p)">Open presenter view</button></div><div id="p"><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="1" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<h2>Coroutines</h2>
<p>in C++</p>
<p class="small-text">
                  Jozef Grajciar
</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="2" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<p>C++ is a language for developing and using elegant and efficient abstractions.</p>
<p class="small-text">
Bjarne Stroustrup, The C++ Programming Language (4th Edition)
</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="3" data-marpit-fragments="2" data-header="Process data" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:Process data;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>Process data</header>

<h2>Motivation : Process data</h2>
<ul>
<li data-marpit-fragment="1">read data from file</li>
<li data-marpit-fragment="2">process data</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="4" data-header="Process data" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:Process data;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>Process data</header>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++">std::vector&lt;data&gt; current_data = <span class="hljs-built_in">read_data</span>();

<span class="hljs-keyword">for</span> (<span class="hljs-type">const</span> <span class="hljs-keyword">auto</span>&amp; data : current_data)
  <span class="hljs-built_in">process_data</span>(data);
</code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="5" data-marpit-scope-sTkKRn4v="" data-marpit-fragments="1" data-header="Process data" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:Process data;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>Process data</header>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++">std::vector&lt;data&gt; current_data = <span class="hljs-built_in">read_data</span>();

<span class="hljs-keyword">for</span> (<span class="hljs-type">const</span> <span class="hljs-keyword">auto</span>&amp; data : current_data)
  <span class="hljs-built_in">process_data</span>(data);
</code></pre>
<br />
<p><strong>Problem</strong>: not possible to read all data to memory.</p>
<ul>
<li data-marpit-fragment="1">We can create <em>reader class</em></li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="6" data-header="Process data" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:Process data;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>Process data</header>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++">  <span class="hljs-keyword">struct</span> <span class="hljs-title class_">data_reader</span>
  {
    <span class="hljs-built_in">data_reader</span>();
    <span class="hljs-function">std::optional&lt;data&gt; <span class="hljs-title">next</span><span class="hljs-params">()</span></span>;
    std::ifstream file;
  };

  data_reader reader;

  <span class="hljs-keyword">while</span> (<span class="hljs-keyword">auto</span> data = reader.<span class="hljs-built_in">next</span>())
    <span class="hljs-built_in">process_data</span>(*data);
</code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="7" data-header="Process data" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:Process data;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>Process data</header>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">data_reader</span>
{
  <span class="hljs-keyword">struct</span> <span class="hljs-title class_">iterator</span>
  {
    <span class="hljs-keyword">using</span> iterator_category = std::forward_iterator_tag;
    <span class="hljs-keyword">using</span> difference_type   = std::<span class="hljs-type">ptrdiff_t</span>;
    <span class="hljs-keyword">using</span> value_type        = data;
    <span class="hljs-keyword">using</span> pointer           = data*;
    <span class="hljs-keyword">using</span> reference         = data&amp;;

    reference <span class="hljs-keyword">operator</span>*();
    pointer <span class="hljs-keyword">operator</span>-&gt;();
    Iterator&amp; <span class="hljs-keyword">operator</span>++();
    <span class="hljs-keyword">friend</span> <span class="hljs-type">bool</span> <span class="hljs-keyword">operator</span>== (<span class="hljs-type">const</span> iterator&amp; a, <span class="hljs-type">const</span> iterator&amp; b);
    <span class="hljs-keyword">friend</span> <span class="hljs-type">bool</span> <span class="hljs-keyword">operator</span>!= (<span class="hljs-type">const</span> iterator&amp; a, <span class="hljs-type">const</span> iterator&amp; b);
</code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="8" data-header="Process data" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:Process data;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>Process data</header>
<p><strong>Problem</strong>: data can be read from multiple sources: file, DB, registry ...</p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">data_reader_file</span> : <span class="hljs-keyword">public</span> data_reader;

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">data_reader_db</span> : <span class="hljs-keyword">public</span> data_reader;

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">data_reader_registry</span> : <span class="hljs-keyword">public</span> data_reader;
</code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="9" data-header="Process data" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:Process data;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>Process data</header>
<p>Solution using coroutines:</p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++"><span class="hljs-keyword">for</span> (<span class="hljs-type">const</span> <span class="hljs-keyword">auto</span>&amp; data : <span class="hljs-built_in">read_data</span>())
  <span class="hljs-built_in">process_data</span>(data);
</code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="10" data-header="Process data" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:Process data;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>Process data</header>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;experimental/generator&gt;</span></span>

std::experimental::generator&lt;data&gt;<span class="hljs-built_in">read_data</span>()
{
  data current_data;

  <span class="hljs-function">std::ifstream <span class="hljs-title">file</span><span class="hljs-params">(...)</span></span>;
  <span class="hljs-keyword">while</span>(file &gt;&gt; current_data)
    <span class="hljs-keyword">co_yield</span> current_data;

  db_handle handle = <span class="hljs-built_in">open_db_handle</span>();
  <span class="hljs-keyword">while</span>(<span class="hljs-built_in">get_data_from_db</span>(handle, current_data))
    <span class="hljs-keyword">co_yield</span> current_data;
}
</code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="11" data-marpit-fragments="3" data-header="Asynchronous commands" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:Asynchronous commands;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>Asynchronous commands</header>

<h2>Motivation : Asynchronous commands</h2>
<ul>
<li data-marpit-fragment="1">process commands asynchronously in multiple threads</li>
<li data-marpit-fragment="2">send command to server</li>
<li data-marpit-fragment="3">receive response in some receiver thread</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="12" data-marpit-fragments="3" data-header="Asynchronous commands" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:Asynchronous commands;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>Asynchronous commands</header>
<p>send_ioctl:</p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++"><span class="hljs-keyword">using</span> buffer = std::vector&lt;<span class="hljs-type">uint8_t</span>&gt;;
<span class="hljs-keyword">using</span> response_cbk = std::function&lt;<span class="hljs-built_in">void</span>(<span class="hljs-type">const</span> buffer&amp;)&gt;;

<span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">send_ioctl</span><span class="hljs-params">(Cmd command,
               <span class="hljs-type">const</span> buffer&amp; input,
               response_cbk response)</span></span>;
</code></pre>
<ul>
<li data-marpit-fragment="1"><code>send_ioctl</code> is non-blocking</li>
<li data-marpit-fragment="2"><code>response_cbk</code> is called in some other receiver thread - <em>continuation</em></li>
<li data-marpit-fragment="3">similar to <code>boost::future.then()</code></li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="13" data-header="Asynchronous commands" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:Asynchronous commands;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>Asynchronous commands</header>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">func1</span><span class="hljs-params">()</span>
</span>{
  ...
  <span class="hljs-built_in">send_ioctl</span>(cmd::process_data, data, on_data_processed);
</code></pre>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">on_data_processed</span><span class="hljs-params">(<span class="hljs-type">const</span> buffer&amp; response)</span>
</span>{
  ...
  <span class="hljs-keyword">if</span> (is_important)
  {
    <span class="hljs-built_in">send_ioctl</span>(cmd::encrypt_data, response, on_data_encrypted);
</code></pre>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">on_data_encrypted</span><span class="hljs-params">(<span class="hljs-type">const</span> buffer* buffer)</span>
</span>{
  ...
</code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="14" data-marpit-fragments="2" data-header="Asynchronous commands" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:Asynchronous commands;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>Asynchronous commands</header>
<ul>
<li data-marpit-fragment="1">may lead to <strong>callback hell</strong></li>
<li data-marpit-fragment="2">may become hard to reason when flow is spread among multiple lambdas/callbacks</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="15" data-header="Asynchronous commands" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:Asynchronous commands;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>Asynchronous commands</header>
<p>Solution using coroutines:</p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++"><span class="hljs-keyword">auto</span> response = <span class="hljs-keyword">co_await</span> <span class="hljs-built_in">send_ioctl_awaiter</span>(cmd::process_data, data);
...
<span class="hljs-keyword">if</span> (is_important)
{
  <span class="hljs-keyword">auto</span> encrypted = <span class="hljs-keyword">co_await</span> <span class="hljs-built_in">send_ioctl_awaiter</span>(cmd::encrypt_data, response);
  <span class="hljs-built_in">on_data_encrypted</span>(encrypted));
}
</code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section data-header="Asynchronous commands" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:Asynchronous commands;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;" data-marpit-advanced-background="background"><div data-marpit-advanced-background-container="true" data-marpit-advanced-background-direction="horizontal"><figure style="background-image:url(&quot;suspension-points-3.png&quot;);background-size:contain;"></figure></div></section></foreignObject><foreignObject width="1280" height="720"><section id="16" data-header="Asynchronous commands" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:Asynchronous commands;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;" data-marpit-advanced-background="content">
<header>Asynchronous commands</header>
</section>
</foreignObject><foreignObject width="1280" height="720" data-marpit-advanced-background="pseudo"><section data-header="Asynchronous commands" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="" data-marpit-advanced-background="pseudo"></section></foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="17" data-header="Asynchronous commands" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:Asynchronous commands;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>Asynchronous commands</header>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">send_ioctl_awaiter</span>
{
    <span class="hljs-built_in">send_ioctl_awaiter</span>(command cmd, buffer data);

    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">await_ready</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; }

    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">await_suspend</span><span class="hljs-params">(std::coroutine_handle&lt;&gt; handle)</span>
    </span>{
        <span class="hljs-built_in">send_ioctl</span>(input_cmd, input_data, [<span class="hljs-keyword">this</span>, handle](buffer res)
        {
            result = res;
            handle.<span class="hljs-built_in">resume</span>();
        });
    }

    <span class="hljs-function">buffer <span class="hljs-title">await_resume</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> result; }
};
</code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="18" data-marpit-fragments="3" data-header="What is a coroutine" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:What is a coroutine;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>What is a coroutine</header>

<h2>What is a coroutine</h2>
<ul>
<li data-marpit-fragment="1">
<p>extension of a subroutine</p>
</li>
<li data-marpit-fragment="2">
<p><strong>subroutine</strong></p>
<ul>
<li><strong>call</strong> - transfer execution to callee</li>
<li><strong>return</strong> - return execution back to caller</li>
</ul>
</li>
<li data-marpit-fragment="3">
<p><strong>coroutine</strong></p>
<ul>
<li><strong>suspend</strong> - suspend execution of coroutine</li>
<li><strong>resume</strong> - resume execution</li>
<li><strong>destroy</strong> - discard coroutine frame</li>
</ul>
</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="19" data-marpit-fragments="3" data-header="Coroutine support" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:Coroutine support;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>Coroutine support</header>

<h2>Coroutine support in language</h2>
<p>Three new language keywords</p>
<ul>
<li data-marpit-fragment="1"><code>co_await</code></li>
<li data-marpit-fragment="2"><code>co_yield</code></li>
<li data-marpit-fragment="3"><code>co_return</code></li>
</ul>
<p>Function which contains any of these keywords is coroutine.<br />
Coroutine can't be distinguished from declaration (implementation detail).</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="20" data-marpit-fragments="4" data-header="Coroutine support" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:Coroutine support;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>Coroutine support</header>
<p>Several new types:</p>
<ul>
<li data-marpit-fragment="1"><code>coroutine_handle&lt;P&gt;</code></li>
<li data-marpit-fragment="2"><code>coroutine_traits&lt;Ts...&gt;</code></li>
<li data-marpit-fragment="3"><code>suspend_always</code></li>
<li data-marpit-fragment="4"><code>suspend_never</code></li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="21" data-marpit-fragments="2" data-header="Coroutine support" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:Coroutine support;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>Coroutine support</header>
<p>Two kinds of interfaces which provides <em>extension points</em>:</p>
<ul>
<li data-marpit-fragment="1"><strong>Awaitable</strong> - generates <code>Awaiters</code> for suspensions</li>
<li data-marpit-fragment="2"><strong>Promise</strong> - defines behavior of whole coroutine</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="22" data-marpit-fragments="5" data-header="co_await" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:co_await;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>co_await</header>

<h2>co_await</h2>
<ul>
<li data-marpit-fragment="1">New language keyword.</li>
<li data-marpit-fragment="2">Usable only in context of coroutine.</li>
<li data-marpit-fragment="3">Can eventually suspend execution.</li>
<li data-marpit-fragment="4"><code>co_await &lt;expr&gt;</code> call <code>&lt;expr&gt;</code> should result to <code>Awaitable</code> or <code>Awaiter</code> object.</li>
<li data-marpit-fragment="5"><code>&lt;expr&gt;</code> can be transformed by promise using <code>await_transform</code> method.</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="23" data-marpit-fragments="3" data-header="co_await" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:co_await;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>co_await</header>
<h3>Awaitable</h3>
<ul>
<li data-marpit-fragment="1">Type that implements <code>operator co_await</code> .</li>
<li data-marpit-fragment="2">Operator should return <code>Awaiter</code> object.</li>
<li data-marpit-fragment="3"><code>Awaitable</code> can be used directly as <code>Awaiter</code>.</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="24" data-marpit-fragments="1" data-header="co_await" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:co_await;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>co_await</header>
<h3>Awaiter</h3>
<ul>
<li data-marpit-fragment="1"><code>co_await</code> call is translated to series of calls of <code>Awaiter</code> type object.</li>
</ul>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Awaiter</span>
{
  <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">await_ready</span><span class="hljs-params">()</span></span>;

  <span class="hljs-type">bool</span>/<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">await_suspend</span><span class="hljs-params">(std::coroutine_handle)</span></span>;

  <span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">await_resume</span><span class="hljs-params">()</span></span>;
}
</code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="25" data-marpit-fragments="3" data-header="co_await" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:co_await;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>co_await</header>
<h3>Awaitable -&gt; Awaiter -&gt; Generated code</h3>
<ul>
<li data-marpit-fragment="1">co_await <code>&lt;anything&gt;</code> -&gt; call to <code>await_transform</code></li>
<li data-marpit-fragment="2">co_await <code>Awaitable</code> -&gt; call to <code>operator co_await</code></li>
<li data-marpit-fragment="3">co_await <code>Awaiter</code></li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="26" data-header="co_await" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:co_await;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>co_await</header>
<h3>example</h3>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++"><span class="hljs-function">my_coroutine <span class="hljs-title">coroutine</span><span class="hljs-params">()</span>
</span>{
  <span class="hljs-keyword">auto</span> some_input = <span class="hljs-keyword">co_await</span> <span class="hljs-number">123</span>;
}
</code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="27" data-header="co_await" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:co_await;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>co_await</header>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">my_coroutine</span>
{
  <span class="hljs-keyword">struct</span> <span class="hljs-title class_">promise_type</span>
  {
    <span class="hljs-function">my_awaitable <span class="hljs-title">await_transform</span><span class="hljs-params">(<span class="hljs-type">int</span> value)</span></span>;
  };
};
</code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="28" data-header="co_await" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:co_await;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>co_await</header>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">my_coroutine</span>
{
  <span class="hljs-keyword">struct</span> <span class="hljs-title class_">promise_type</span>
  {
    <span class="hljs-function">my_awaitable <span class="hljs-title">await_transform</span><span class="hljs-params">(<span class="hljs-type">int</span> value)</span></span>;
  };
};
</code></pre>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">my_awaitable</span>
{
  <span class="hljs-function">my_awaiter <span class="hljs-keyword">operator</span> <span class="hljs-title">co_await</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">noexcept</span></span>;
};
</code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="29" data-header="co_await" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:co_await;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>co_await</header>
<p>Provide <code>Awaiter</code> directly to <code>co_await</code>.</p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++"><span class="hljs-function">my_coroutine <span class="hljs-title">coroutine</span><span class="hljs-params">()</span>
</span>{
  <span class="hljs-keyword">auto</span> some_input = <span class="hljs-keyword">co_await</span> my_awaiter{};
}
</code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="30" data-header="co_await" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:co_await;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>co_await</header>
<h3>Generated code</h3>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++">{
  <span class="hljs-keyword">if</span> (!awaiter.<span class="hljs-built_in">await_ready</span>())
  {
    &lt;suspend-point&gt;

    <span class="hljs-keyword">if</span> (awaiter.<span class="hljs-built_in">await_suspend</span>(handle))
    {
      &lt;<span class="hljs-keyword">return</span>-to-caller&gt;
    }

    &lt;resume-point&gt;
  }

  <span class="hljs-keyword">return</span> awaiter.<span class="hljs-built_in">await_resume</span>();
}
</code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="31" data-header="co_await" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:co_await;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>co_await</header>
<h3>send_ioctl revisited</h3>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">send_ioctl_awaiter</span>
{
    <span class="hljs-built_in">send_ioctl_awaiter</span>(command cmd, buffer data);

    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">await_ready</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; }

    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">await_suspend</span><span class="hljs-params">(std::coroutine_handle&lt;&gt; handle)</span>
    </span>{
        <span class="hljs-built_in">send_ioctl</span>(input_cmd, input_data, [<span class="hljs-keyword">this</span>, handle](buffer res)
        {
            result = res;
            handle.<span class="hljs-built_in">resume</span>();
        });
    }

    <span class="hljs-function">buffer <span class="hljs-title">await_resume</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> result; }
};
</code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="32" data-marpit-fragments="2" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<h2>coroutine_handle</h2>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++">  <span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> Promise&gt;
  <span class="hljs-keyword">struct</span> <span class="hljs-title class_">coroutine_handle</span>&lt;Promise&gt;
  {
    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">done</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;

    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">resume</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">destroy</span><span class="hljs-params">()</span></span>;

    <span class="hljs-function">Promise&amp; <span class="hljs-title">promise</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;

    <span class="hljs-function"><span class="hljs-type">static</span> coroutine_handle <span class="hljs-title">from_promise</span><span class="hljs-params">(Promise&amp; promise)</span></span>;

    <span class="hljs-function"><span class="hljs-type">void</span>* <span class="hljs-title">address</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;
    <span class="hljs-function"><span class="hljs-type">static</span> coroutine_handle <span class="hljs-title">from_address</span><span class="hljs-params">(<span class="hljs-type">void</span>* address)</span></span>;
  };
</code></pre>
<ul>
<li data-marpit-fragment="1">Handle to coroutine frame.</li>
<li data-marpit-fragment="2">Can be used to resume/destroy coroutine</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="33" data-marpit-fragments="2" data-header="Coroutine as function" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:Coroutine as function;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>Coroutine as function</header>

<h2>Coroutine as a function</h2>
<ul>
<li data-marpit-fragment="1">Implementation contains at least one of <code>co_</code> keywords.</li>
<li data-marpit-fragment="2">Coroutine returns object which has nested <code>promise_type</code></li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="34" data-marpit-fragments="1" data-header="Coroutine as function" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:Coroutine as function;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>Coroutine as function</header>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++"><span class="hljs-function">my_coroutine <span class="hljs-title">coroutine</span><span class="hljs-params">()</span>
</span>{
  <span class="hljs-keyword">co_return</span> <span class="hljs-number">1</span>;
}
</code></pre>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">my_coroutine</span>
{
  <span class="hljs-keyword">struct</span> <span class="hljs-title class_">promise_type</span>
  {
    ...
  };
};
</code></pre>
<ul>
<li data-marpit-fragment="1"><code>my_coroutine</code> defines interface for caller above required <code>promise_type</code></li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="35" data-marpit-fragments="2" data-header="promise_type" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:promise_type;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>promise_type</header>

<h2>Promise <code>promise_type</code></h2>
<ul>
<li data-marpit-fragment="1">Specifies methods for customizing behavior of coroutine itself.</li>
<li data-marpit-fragment="2">Methods are called at specific points during execution.</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="36" data-header="promise_type" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:promise_type;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>promise_type</header>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++">{
  <span class="hljs-keyword">co_await</span> promise.<span class="hljs-built_in">initial_suspend</span>();
  <span class="hljs-keyword">try</span>
  {
    &lt;coroutine-body&gt;
  }
  <span class="hljs-built_in">catch</span> (...)
  {
    promise.<span class="hljs-built_in">unhandled_exception</span>();
  }
FinalSuspend:
  <span class="hljs-keyword">co_await</span> promise.<span class="hljs-built_in">final_suspend</span>();
}
</code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="37" data-marpit-fragments="2" data-header="promise_type" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:promise_type;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>promise_type</header>
<h3>Promise required interface</h3>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">promise_type</span>
{
  <span class="hljs-function">awaiter <span class="hljs-title">initial_suspend</span><span class="hljs-params">()</span></span>;
  <span class="hljs-function">awaiter <span class="hljs-title">final_suspend</span><span class="hljs-params">()</span></span>;

  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">unhandled_exception</span><span class="hljs-params">()</span></span>;

  ...
</code></pre>
<ul>
<li data-marpit-fragment="1">Body of coroutine is inside try-catch block.</li>
<li data-marpit-fragment="2">Exception is provided in <code>unhandled_exception()</code></li>
</ul>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">unhandled_exception</span><span class="hljs-params">()</span> </span>{ _exception = _std::<span class="hljs-built_in">current_exception</span>(); }
</code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="38" data-marpit-fragments="3" data-header="promise_type" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:promise_type;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>promise_type</header>
<h3>Entering coroutine function</h3>
<ul>
<li data-marpit-fragment="1">allocate coroutine frame</li>
<li data-marpit-fragment="2">create return object using <code>get_return_object</code> of promise</li>
<li data-marpit-fragment="3"><code>co_await</code> the awaiter of <code>initial_suspend</code></li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="39" data-header="promise_type" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:promise_type;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>promise_type</header>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++"><span class="hljs-function">my_coroutine <span class="hljs-title">coroutine</span><span class="hljs-params">()</span>
</span>{
  __coroutine_frame* __frame = <span class="hljs-keyword">new</span> __coroutine_frame{};

  my_coroutine __return = __frame-&gt;_promise.<span class="hljs-built_in">get_return_object</span>();

  <span class="hljs-keyword">co_await</span> __frame-&gt;_promise.<span class="hljs-built_in">initial_suspend</span>();

  ...
}
</code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="40" data-marpit-fragments="3" data-header="promise_type" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:promise_type;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>promise_type</header>
<h3>Coroutine frame</h3>
<ul>
<li data-marpit-fragment="1">Contains:
<ul>
<li>parameters of function (move or copy)</li>
<li>execution state for when coroutine is suspended</li>
<li>promise of coroutine</li>
</ul>
</li>
<li data-marpit-fragment="2">Dynamically allocated, but can be optimized by compiler.</li>
<li data-marpit-fragment="3">Allocation can be customized.</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="41" data-header="promise_type" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:promise_type;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>promise_type</header>
<h3>Promise required interface</h3>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">promise_type</span>
{
  <span class="hljs-function">awaiter <span class="hljs-title">initial_suspend</span><span class="hljs-params">()</span></span>;
  <span class="hljs-function">awaiter <span class="hljs-title">final_suspend</span><span class="hljs-params">()</span></span>;

  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">unhandled_exception</span><span class="hljs-params">()</span></span>;

  <span class="hljs-function">my_coroutine <span class="hljs-title">get_return_object</span><span class="hljs-params">()</span></span>;

  ...

</code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="42" data-marpit-fragments="2" data-header="promise_type" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:promise_type;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>promise_type</header>
<h3>Returning from coroutine</h3>
<ul>
<li data-marpit-fragment="1">Keyword <code>co_return</code></li>
<li data-marpit-fragment="2">Finishes execution of coroutine</li>
</ul>
<p><code>co_return &lt;expr&gt;</code> translates into:</p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++">promise.<span class="hljs-built_in">return_void</span>();
<span class="hljs-keyword">goto</span> FinalSuspend
</code></pre>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++">promise.<span class="hljs-built_in">return_value</span>(&lt;expr&gt;);
<span class="hljs-keyword">goto</span> FinalSuspend;
</code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="43" data-header="promise_type" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:promise_type;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>promise_type</header>
<h3>Promise required interface</h3>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">promise_type</span>
{
  <span class="hljs-function">awaiter <span class="hljs-title">initial_suspend</span><span class="hljs-params">()</span></span>;
  <span class="hljs-function">awaiter <span class="hljs-title">final_suspend</span><span class="hljs-params">()</span></span>;

  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">unhandled_exception</span><span class="hljs-params">()</span></span>;

  <span class="hljs-function">my_coroutine <span class="hljs-title">get_return_object</span><span class="hljs-params">()</span></span>;

  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">return_void</span><span class="hljs-params">()</span></span>;
  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">return_value</span><span class="hljs-params">(<span class="hljs-keyword">auto</span> value)</span></span>;

  ...

</code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="44" data-marpit-fragments="4" data-header="promise_type" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:promise_type;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>promise_type</header>
<h3>Reaching final suspend</h3>
<ul>
<li data-marpit-fragment="1">Final logic before execution is returned back to caller.</li>
<li data-marpit-fragment="2">If coroutine suspends on final suspend point, it can't be resumed.</li>
<li data-marpit-fragment="3">Recommended to always suspend in final suspend.</li>
<li data-marpit-fragment="4">If suspended coroutine must be manually destroyed using handle from outside.</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="45" data-header="promise_type" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:promise_type;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>promise_type</header>
<h3>Specifying <code>promise_type</code></h3>
<p>Compiler uses following <code>promise_type</code> in coroutine:</p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++"><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> RET, <span class="hljs-keyword">typename</span>... ARGS&gt;
<span class="hljs-keyword">using</span> promise = std::coroutine_traits&lt;RET, ...ARGS&gt;::promise_type;
</code></pre>
<p>By default <code>coroutine_traits</code> returns <code>promise_type</code> nested inside <code>RET</code></p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++"><span class="hljs-keyword">using</span> promise_type = RET::promise_type;
</code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="46" data-header="promise_type" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:promise_type;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>promise_type</header>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++"><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T, <span class="hljs-keyword">typename</span>... Args&gt;
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">std</span>::coroutine_traits&lt;std::future&lt;T&gt;, Args...&gt;
{
  <span class="hljs-keyword">struct</span> <span class="hljs-title class_">promise_type</span>
  {
    std::promise&lt;T&gt; _promise;

    <span class="hljs-function">std::future&lt;T&gt; <span class="hljs-title">get_return_object</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> _promise.<span class="hljs-built_in">get_future</span>(); }
    
    <span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">initial_suspend</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> std::suspend_never{}; }
    <span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">final_suspend</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> std::suspend_never{}; }

    <span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> U&gt;
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">return_value</span><span class="hljs-params">(U&amp;&amp; value)</span> </span>{ _promise.<span class="hljs-built_in">set_value</span>(std::forward&lt;U&gt;(value)); }
  };
};
</code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="47" data-marpit-fragments="2" data-header="promise_type" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:promise_type;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>promise_type</header>
<h3>Yielding value</h3>
<ul>
<li data-marpit-fragment="1">Last special language keyword <code>co_yield</code></li>
<li data-marpit-fragment="2"><code>co_yield &lt;expr&gt;</code> is translated into</li>
</ul>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++"><span class="hljs-keyword">co_await</span> promise.<span class="hljs-built_in">yield_value</span>(&lt;expr&gt;)
</code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="48" data-header="promise_type" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:promise_type;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>promise_type</header>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">promise_type</span>
{
  <span class="hljs-function">awaiter <span class="hljs-title">initial_suspend</span><span class="hljs-params">()</span></span>;
  <span class="hljs-function">awaiter <span class="hljs-title">final_suspend</span><span class="hljs-params">()</span></span>;

  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">unhandled_exception</span><span class="hljs-params">()</span></span>;

  <span class="hljs-function">my_coroutine <span class="hljs-title">get_return_object</span><span class="hljs-params">()</span></span>;

  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">return_void</span><span class="hljs-params">()</span></span>;
  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">return_value</span><span class="hljs-params">(<span class="hljs-keyword">auto</span> value)</span></span>;

  <span class="hljs-function">awaiter <span class="hljs-title">yield_value</span><span class="hljs-params">(<span class="hljs-keyword">auto</span> value)</span></span>;

  ...

</code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="49" data-header="Synchronous example" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:Synchronous example;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>Synchronous example</header>

<h2>Synchronous coroutine - example</h2>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="50" data-header="Synchronous example" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:Synchronous example;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>Synchronous example</header>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++">    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">test</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-keyword">auto</span> test = <span class="hljs-built_in">coroutine</span>();

        test.<span class="hljs-built_in">resume</span>();

        std::cout &lt;&lt; test.<span class="hljs-built_in">value</span>();

        test.<span class="hljs-built_in">resume</span>();

        std::cout &lt;&lt; test.<span class="hljs-built_in">value</span>();
    }
</code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="51" data-header="Synchronous example" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:Synchronous example;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>Synchronous example</header>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++"><span class="hljs-function">task&lt;std::string&gt; <span class="hljs-title">coroutine</span><span class="hljs-params">()</span>
</span>{
    std::cout &lt;&lt; <span class="hljs-string">&quot;Entered coroutine\n&quot;</span>;

    <span class="hljs-comment">// stuff</span>

    <span class="hljs-keyword">co_yield</span> <span class="hljs-string">&quot;Reached checkpoint 1\n&quot;</span>;

    <span class="hljs-comment">// stuff</span>

    <span class="hljs-keyword">co_yield</span> <span class="hljs-string">&quot;Reached checkpoint 2\n&quot;</span>;

    std::cout &lt;&lt; <span class="hljs-string">&quot;Leaving coroutine\n&quot;</span>;
}
</code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="52" data-header="Synchronous example" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:Synchronous example;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>Synchronous example</header>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">class</span> <span class="hljs-title class_">T</span>&gt;
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">task</span>
{
  std::coroutine_handle&lt;promise_type&gt; _coroutine = <span class="hljs-literal">nullptr</span>;

  <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">task</span><span class="hljs-params">(std::coroutine_handle&lt;promise_type&gt; coroutine)</span>
    : _coroutine(coroutine) {</span>}
  ~<span class="hljs-built_in">task</span>()
  {
    <span class="hljs-keyword">if</span> (_coroutine) _coroutine.<span class="hljs-built_in">destroy</span>();
  }

  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">resume</span><span class="hljs-params">()</span> </span>{ _coroutine.<span class="hljs-built_in">resume</span>(); }
  <span class="hljs-function"><span class="hljs-type">const</span> T&amp; <span class="hljs-title">value</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> _coroutine.<span class="hljs-built_in">promise</span>().value; }
};
</code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="53" data-header="Synchronous example" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:Synchronous example;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>Synchronous example</header>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">promise_type</span>
{
  std::string value;

  <span class="hljs-function">task <span class="hljs-title">get_return_object</span><span class="hljs-params">()</span>
  </span>{
    <span class="hljs-keyword">auto</span> handle = std::coroutine_handle&lt;promise_type&gt;::<span class="hljs-built_in">from_promise</span>(*<span class="hljs-keyword">this</span>);
    <span class="hljs-keyword">return</span> task{ handle };;
  }
  <span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">initial_suspend</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> std::suspend_always{}; }
  <span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">final_suspend</span><span class="hljs-params">()</span> <span class="hljs-keyword">noexcept</span> </span>{ <span class="hljs-keyword">return</span> std::suspend_always{}; }
  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">return_void</span><span class="hljs-params">()</span> </span>{}
  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">unhandled_exception</span><span class="hljs-params">()</span> </span>{ std::<span class="hljs-built_in">terminate</span>(); }

  <span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">yield_value</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span>* data)</span>
  </span>{
    value = data;
    <span class="hljs-keyword">return</span> std::suspend_always{};
  }
};
</code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="54" data-marpit-fragments="3" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<h3>Problems with coroutines:</h3>
<ul>
<li data-marpit-fragment="1">currently very small support in language (<code>std::generator</code> is coming to c++23)</li>
<li data-marpit-fragment="2">hard to use and hard to use correctly (because of extreme possibility for customizations which is not case for other languages)</li>
<li data-marpit-fragment="3">need for 3rd-party libraries like <code>cppcoro</code> or <code>folly</code></li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="55" data-header="cppcoro" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:cppcoro;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>cppcoro</header>

<h2>cppcoro</h2>
<p>Library by <em>Lewis Baker</em></p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="56" data-header="cppcoro" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:cppcoro;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>cppcoro</header>
<h3>Example: <em>Threadpool scheduling</em></h3>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++">cppcoro::task&lt;&gt; <span class="hljs-built_in">do_on_threadpool</span>(cppcoro::static_thread_pool&amp; tp)
{
    <span class="hljs-keyword">co_await</span> tp.<span class="hljs-built_in">schedule</span>();
    std::cout &lt;&lt; <span class="hljs-string">&quot;doing on thread &quot;</span> &lt;&lt; std::this_thread::<span class="hljs-built_in">get_id</span>() &lt;&lt; <span class="hljs-string">&quot;\n&quot;</span>;
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{
  cppcoro::static_thread_pool threadpool;
  std::cout &lt;&lt; <span class="hljs-string">&quot;calling on thread &quot;</span> &lt;&lt; std::this_thread::<span class="hljs-built_in">get_id</span>() &lt;&lt; <span class="hljs-string">&quot;\n&quot;</span>;
  cppcoro::<span class="hljs-built_in">sync_wait</span>(<span class="hljs-built_in">do_on_threadpool</span>(threadpool));
}
</code></pre>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code>calling on thread 7372
doing on thread 12928
</code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="57" data-header="cppcoro" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:cppcoro;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>cppcoro</header>
<h3>Example: <em>Waiting for multiple coroutines</em></h3>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++"><span class="hljs-function">cppcoro::task&lt;data&gt; <span class="hljs-title">get_data1</span><span class="hljs-params">()</span></span>;
<span class="hljs-function">cppcoro::task&lt;data&gt; <span class="hljs-title">get_data2</span><span class="hljs-params">()</span></span>;

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">func</span><span class="hljs-params">()</span>
</span>{
  <span class="hljs-keyword">auto</span> [data1, data2] = <span class="hljs-keyword">co_await</span> <span class="hljs-built_in">when_all</span>(<span class="hljs-built_in">get_data1</span>(), <span class="hljs-built_in">get_data2</span>());
  ...
</code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="58" data-header="cppcoro" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:cppcoro;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>cppcoro</header>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++"><span class="hljs-function">cppcoro::task&lt;std::thread::id&gt; <span class="hljs-title">do_on_tp</span><span class="hljs-params">(cppcoro::static_thread_pool&amp; tp)</span>
</span>{
    <span class="hljs-keyword">co_await</span> tp.<span class="hljs-built_in">schedule</span>();
    std::cout &lt;&lt; <span class="hljs-string">&quot;Now working on thread &quot;</span> &lt;&lt; std::this_thread::<span class="hljs-built_in">get_id</span>() &lt;&lt; <span class="hljs-string">&quot;\n&quot;</span>;
    std::this_thread::<span class="hljs-built_in">sleep_for</span>(<span class="hljs-number">2</span>s);
    <span class="hljs-keyword">co_return</span> std::this_thread::<span class="hljs-built_in">get_id</span>();
}
</code></pre>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++">    std::cout &lt;&lt; <span class="hljs-string">&quot;Calling on thread: &quot;</span> &lt;&lt; std::this_thread::<span class="hljs-built_in">get_id</span>() &lt;&lt; <span class="hljs-string">&quot;\n&quot;</span>;

    cppcoro::static_thread_pool tp;
    <span class="hljs-keyword">auto</span> [t1, t2] = cppcoro::<span class="hljs-built_in">sync_wait</span>(cppcoro::<span class="hljs-built_in">when_all</span>(<span class="hljs-built_in">do_on_tp</span>(tp), <span class="hljs-built_in">do_on_tp</span>(tp)));

    std::cout &lt;&lt; <span class="hljs-string">&quot;Executed on: &quot;</span> &lt;&lt; t1 &lt;&lt; <span class="hljs-string">&quot; &quot;</span> &lt;&lt; t2 &lt;&lt; <span class="hljs-string">&quot;\n&quot;</span>;
</code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="59" data-header="cppcoro" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:cppcoro;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>cppcoro</header>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++">Calling on thread: <span class="hljs-number">3348</span>
Now working on thread <span class="hljs-number">14680</span>
Now working on thread <span class="hljs-number">12332</span>
Executed on: <span class="hljs-number">14680</span> <span class="hljs-number">12332</span>
</code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="60" data-header="cppcoro" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:cppcoro;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>cppcoro</header>
<h1>Thank You</h1>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="61" data-marpit-fragments="5" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<p>References:</p>
<ul>
<li data-marpit-fragment="1">James McNellis - Introduction to Coroutines (CppCon 2016) <p class="small-text">(<a href="https://www.youtube.com/watch?v=ZTqHjjm86Bw">https://www.youtube.com/watch?v=ZTqHjjm86Bw</a></p></li>
<li data-marpit-fragment="2">Lewis Baker - Posts on Coroutines <p class="small-text"><a href="https://lewissbaker.github.io">https://lewissbaker.github.io</a></p></li>
<li data-marpit-fragment="3">Lewis Baker - Structured Concurrency (CppCon 2019)<p class="small-text"><a href="https://www.youtube.com/watch?v=1Wy5sq3s2rg">https://www.youtube.com/watch?v=1Wy5sq3s2rg</a></p></li>
<li data-marpit-fragment="4">Eric Niebler - Structured Concurrency <p class="small-text"><a href="https://ericniebler.com/2020/11/08/structured-concurrency/">https://ericniebler.com/2020/11/08/structured-concurrency/</a></p></li>
<li data-marpit-fragment="5">Adi Shavit - Generators (code::dive 2019) <p class="small-text"><a href="https://www.youtube.com/watch?v=ahorllPz5rE">https://www.youtube.com/watch?v=ahorllPz5rE</a></p></li>
</ul>
</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="62" data-marpit-fragments="1" data-header="Chaining" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:Chaining;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>Chaining</header>

<h2>Bonus: Coroutine chaining</h2>
<ul>
<li data-marpit-fragment="1">co_await one coroutine from another</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="63" data-marpit-fragments="2" data-header="Chaining" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:Chaining;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>Chaining</header>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++"><span class="hljs-function">task&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">foo</span><span class="hljs-params">()</span>
</span>{
  <span class="hljs-keyword">co_return</span>;
}

<span class="hljs-function">task&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">bar</span><span class="hljs-params">()</span>
</span>{
  <span class="hljs-function"><span class="hljs-keyword">co_await</span> <span class="hljs-title">foo</span><span class="hljs-params">()</span></span>;
}
</code></pre>
<ul>
<li data-marpit-fragment="1">make <code>task</code> awaitable</li>
<li data-marpit-fragment="2">resume the parent coroutine if child finish executing</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="64" data-header="Chaining" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:Chaining;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>Chaining</header>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">class</span> <span class="hljs-title class_">T</span>&gt;
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">task</span>
{
  std::coroutine_handle&lt;promise_type&gt; _coroutine = <span class="hljs-literal">nullptr</span>;

  <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">task</span><span class="hljs-params">(std::coroutine_handle&lt;promise_type&gt; coroutine)</span></span>;
  ~<span class="hljs-built_in">task</span>();

  <span class="hljs-function">awaiter <span class="hljs-keyword">operator</span> <span class="hljs-title">co_await</span><span class="hljs-params">()</span> &amp;&amp; <span class="hljs-keyword">noexcept</span></span>;

  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">resume</span><span class="hljs-params">()</span> </span>{ _coroutine.<span class="hljs-built_in">resume</span>(); }
  <span class="hljs-function"><span class="hljs-type">const</span> T&amp; <span class="hljs-title">value</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> _coroutine.<span class="hljs-built_in">promise</span>().value; }
};
</code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="65" data-header="Chaining" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:Chaining;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>Chaining</header>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">promise_type</span>
{
  std::string value;

  <span class="hljs-function">task <span class="hljs-title">get_return_object</span><span class="hljs-params">()</span></span>;
  <span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">initial_suspend</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> std::suspend_always{}; }

  <span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">final_suspend</span><span class="hljs-params">()</span> <span class="hljs-keyword">noexcept</span> </span>{ <span class="hljs-keyword">return</span> final_awaiter{}; }

  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">return_void</span><span class="hljs-params">()</span> </span>{}
  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">unhandled_exception</span><span class="hljs-params">()</span> </span>{ std::<span class="hljs-built_in">terminate</span>(); }
</code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="66" data-header="Chaining" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:Chaining;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>Chaining</header>
<p>Methods of this awaiter will be expanded for <code>co_await</code> expression in caller but will be constructed by awaitable of callee.</p>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">awaiter</span>
{
  <span class="hljs-built_in">awaiter</span>(std::coroutine_handle&lt;task::promise_type&gt;&amp; handle) <span class="hljs-keyword">noexcept</span>
    : <span class="hljs-built_in">handle</span>(handle) {}

  <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">await_ready</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; }
  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">await_suspend</span><span class="hljs-params">(std::coruotine_handle&lt;&gt; caller_handle)</span>
  </span>{
      handle.<span class="hljs-built_in">promise</span>().caller_handle = caller_handle;
      handle.<span class="hljs-built_in">resume</span>();
  }
</code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="67" data-header="Chaining" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:Chaining;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>Chaining</header>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++"><span class="hljs-function">task&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">foo</span><span class="hljs-params">()</span>
</span>{
  <span class="hljs-keyword">co_return</span>;
}

<span class="hljs-function">task&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">bar</span><span class="hljs-params">()</span>
</span>{
  <span class="hljs-function"><span class="hljs-keyword">co_await</span> <span class="hljs-title">foo</span><span class="hljs-params">()</span></span>;
}
</code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="68" data-header="Chaining" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:Chaining;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>Chaining</header>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">final_awaiter</span>
{
  <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">await_ready</span><span class="hljs-params">()</span> <span class="hljs-keyword">noexcept</span> </span>{ <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; }
  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">await_suspend</span><span class="hljs-params">(std::coroutine_handle&lt;task::promise_type&gt; handle)</span> <span class="hljs-keyword">noexcept</span>
  </span>{
    <span class="hljs-keyword">if</span> (handle.<span class="hljs-built_in">promise</span>().caller_handle)
      handle.<span class="hljs-built_in">promise</span>().caller_handle.<span class="hljs-built_in">resume</span>();
  }
</code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="69" data-marpit-fragments="4" data-header="Chaining" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:Chaining;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>Chaining</header>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++"><span class="hljs-function">task&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">foo</span><span class="hljs-params">()</span>
</span>{
  <span class="hljs-keyword">co_return</span>;
}
<span class="hljs-function">task&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">bar</span><span class="hljs-params">()</span>
</span>{
  <span class="hljs-function"><span class="hljs-keyword">co_await</span> <span class="hljs-title">foo</span><span class="hljs-params">()</span></span>;
}
</code></pre>
<ul>
<li data-marpit-fragment="1"><code>co_await foo();</code></li>
<li data-marpit-fragment="2"><code>foo</code> starts executing and suspends on <code>initial_suspend</code></li>
<li data-marpit-fragment="3"><code>awaiter</code> is constructed by <code>operator co_await</code></li>
<li data-marpit-fragment="4"><code>awaiter</code> stores handle to caller in promise and resumes <code>foo</code></li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="70" data-marpit-fragments="4" data-header="Chaining" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:Chaining;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>Chaining</header>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++"><span class="hljs-function">task&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">foo</span><span class="hljs-params">()</span>
</span>{
  <span class="hljs-keyword">co_return</span>;
}
<span class="hljs-function">task&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">bar</span><span class="hljs-params">()</span>
</span>{
  <span class="hljs-function"><span class="hljs-keyword">co_await</span> <span class="hljs-title">foo</span><span class="hljs-params">()</span></span>;
}
</code></pre>
<ul>
<li data-marpit-fragment="1"><code>co_return;</code></li>
<li data-marpit-fragment="2">coroutine reaches <code>final_suspend</code></li>
<li data-marpit-fragment="3"><code>final_awaiter</code> is constructed and awaited</li>
<li data-marpit-fragment="4">there caller is resumed using his handle stored in promise</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="71" data-header="Chaining" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:Chaining;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>Chaining</header>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code>bar -&gt;
  awaiter::await_suspend() -&gt;
    foo handle resume -&gt;
      foo -&gt;
       final_awaiter::await_suspend -&gt;
         bar handle resume -&gt;
           bar
</code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="72" data-header="Chaining" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:Chaining;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>Chaining</header>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++">  <span class="hljs-function">task&lt;std::string&gt; <span class="hljs-title">bar</span><span class="hljs-params">()</span>
  </span>{
      <span class="hljs-keyword">co_return</span>;
  }
  <span class="hljs-function">task&lt;std::string&gt; <span class="hljs-title">foo</span><span class="hljs-params">()</span>
  </span>{
      <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1&#x27;000&#x27;000</span>; i++)
          <span class="hljs-function"><span class="hljs-keyword">co_await</span> <span class="hljs-title">bar</span><span class="hljs-params">()</span></span>;
  }
</code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section data-header="Chaining" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:Chaining;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;" data-marpit-advanced-background="background"><div data-marpit-advanced-background-container="true" data-marpit-advanced-background-direction="horizontal"><figure style="background-image:url(&quot;stack-overflow.png&quot;);background-size:contain;"></figure></div></section></foreignObject><foreignObject width="1280" height="720"><section id="73" data-header="Chaining" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:Chaining;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;" data-marpit-advanced-background="content">
<header>Chaining</header>
</section>
</foreignObject><foreignObject width="1280" height="720" data-marpit-advanced-background="pseudo"><section data-header="Chaining" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="" data-marpit-advanced-background="pseudo"></section></foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="74" data-marpit-fragments="3" data-header="Chaining" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:Chaining;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>Chaining</header>
<h3>Symmetric transfer</h3>
<ul>
<li data-marpit-fragment="1">tail recursion</li>
<li data-marpit-fragment="2">code under control of compiler</li>
<li data-marpit-fragment="3">guaranteed tail-call optimization</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="75" data-header="Chaining" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:Chaining;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>Chaining</header>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">awaiter</span>
{
  std::coroutine_handle&lt;&gt; <span class="hljs-built_in">await_suspend</span>(std::coroutine_handle&lt;&gt; handle);
}
</code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="76" data-header="Chaining" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:Chaining;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>Chaining</header>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">awaiter</span>
{
  <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">await_ready</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; }
  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">await_suspend</span><span class="hljs-params">(std::coroutine_handle&lt;&gt; caller_handle)</span>
  </span>{
    handle.<span class="hljs-built_in">promise</span>().caller_handle = caller_handle;
    handle.<span class="hljs-built_in">resume</span>();
  }
</code></pre>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">awaiter</span>
{
  <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">await_ready</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; }
  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">await_suspend</span><span class="hljs-params">(std::coroutine_handle&lt;&gt; caller_handle)</span>
  </span>{
    handle.<span class="hljs-built_in">promise</span>().caller_handle = caller_handle;
    <span class="hljs-keyword">return</span> handle;
  }
</code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="77" data-header="Chaining" data-theme="uncover" data-style="section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
" style="--header:Chaining;--theme:uncover;--style:section {
  text-align: left;
  font-size: 35px;
}
.small-text {
  text-align: right;
  font-size: 0.65rem;
}
h1 h2 {
  color: #403837;
}
ul {
  margin-left: 0;
}
pre {
  width: 100%;
}
header {
  padding-left: 0px;
  font-size: 25px;
  padding-top: 0px;
}
;">
<header>Chaining</header>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">final_awaiter</span>
{
  <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">await_ready</span><span class="hljs-params">()</span> <span class="hljs-keyword">noexcept</span> </span>{ <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; }
  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">await_suspend</span><span class="hljs-params">(std::coroutine_handle&lt;&gt; handle)</span> <span class="hljs-keyword">noexcept</span>
  </span>{
    <span class="hljs-keyword">if</span> (handle.<span class="hljs-built_in">promise</span>().caller_handle)
      handle.<span class="hljs-built_in">promise</span>().caller_handle.<span class="hljs-built_in">resume</span>();
  }
</code></pre>
<pre is="marp-pre" data-auto-scaling="downscale-only"><code class="language-c++"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">final_awaiter</span>
{
  <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">await_ready</span><span class="hljs-params">()</span> <span class="hljs-keyword">noexcept</span> </span>{ <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; }
  std::coroutine_handle&lt;&gt; <span class="hljs-built_in">await_suspend</span>(std::coroutine_handle&lt;&gt; handle) <span class="hljs-keyword">noexcept</span>
  {
    <span class="hljs-keyword">if</span> (handle.<span class="hljs-built_in">promise</span>().caller_handle)
      <span class="hljs-keyword">return</span> handle.<span class="hljs-built_in">promise</span>().caller_handle;
    <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">noop_coroutine</span>();
  }
</code></pre>
</section>
<script>!function(){"use strict";const t={h1:{proto:()=>HTMLHeadingElement,attrs:{role:"heading","aria-level":"1"},style:"display: block; font-size: 2em; margin-block-start: 0.67em; margin-block-end: 0.67em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},h2:{proto:()=>HTMLHeadingElement,attrs:{role:"heading","aria-level":"2"},style:"display: block; font-size: 1.5em; margin-block-start: 0.83em; margin-block-end: 0.83em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},h3:{proto:()=>HTMLHeadingElement,attrs:{role:"heading","aria-level":"3"},style:"display: block; font-size: 1.17em; margin-block-start: 1em; margin-block-end: 1em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},h4:{proto:()=>HTMLHeadingElement,attrs:{role:"heading","aria-level":"4"},style:"display: block; margin-block-start: 1.33em; margin-block-end: 1.33em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},h5:{proto:()=>HTMLHeadingElement,attrs:{role:"heading","aria-level":"5"},style:"display: block; font-size: 0.83em; margin-block-start: 1.67em; margin-block-end: 1.67em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},h6:{proto:()=>HTMLHeadingElement,attrs:{role:"heading","aria-level":"6"},style:"display: block; font-size: 0.67em; margin-block-start: 2.33em; margin-block-end: 2.33em; margin-inline-start: 0px; margin-inline-end: 0px; font-weight: bold;"},span:{proto:()=>HTMLSpanElement},pre:{proto:()=>HTMLElement,style:"display: block; font-family: monospace; white-space: pre; margin: 1em 0; --marp-auto-scaling-white-space: pre;"}},e="data-marp-auto-scaling-wrapper",i="data-marp-auto-scaling-svg",n="data-marp-auto-scaling-container";class s extends HTMLElement{constructor(){super(),this.svgPreserveAspectRatio="xMinYMid meet";const t=t=>([e])=>{const{width:i,height:n}=e.contentRect;this[t]={width:i,height:n},this.updateSVGRect()};this.attachShadow({mode:"open"}),this.containerObserver=new ResizeObserver(t("containerSize")),this.wrapperObserver=new ResizeObserver(((...e)=>{t("wrapperSize")(...e),this.flushSvgDisplay()}))}static get observedAttributes(){return["data-downscale-only"]}connectedCallback(){var t,s,o,r,a;this.shadowRoot.innerHTML=`\n<style>\n  svg[${i}] { display: block; width: 100%; height: auto; vertical-align: top; }\n  span[${n}] { display: table; white-space: var(--marp-auto-scaling-white-space, nowrap); width: max-content; }\n</style>\n<div ${e}>\n  <svg part="svg" ${i}>\n    <foreignObject><span ${n}><slot></slot></span></foreignObject>\n  </svg>\n</div>\n    `.split(/\n\s*/).join(""),this.wrapper=null!==(t=this.shadowRoot.querySelector(`div[${e}]`))&&void 0!==t?t:void 0;const l=this.svg;this.svg=null!==(o=null===(s=this.wrapper)||void 0===s?void 0:s.querySelector(`svg[${i}]`))&&void 0!==o?o:void 0,this.svg!==l&&(this.svgComputedStyle=this.svg?window.getComputedStyle(this.svg):void 0),this.container=null!==(a=null===(r=this.svg)||void 0===r?void 0:r.querySelector(`span[${n}]`))&&void 0!==a?a:void 0,this.observe()}disconnectedCallback(){this.svg=void 0,this.svgComputedStyle=void 0,this.wrapper=void 0,this.container=void 0,this.observe()}attributeChangedCallback(){this.observe()}flushSvgDisplay(){const{svg:t}=this;t&&(t.style.display="inline",requestAnimationFrame((()=>{t.style.display=""})))}observe(){this.containerObserver.disconnect(),this.wrapperObserver.disconnect(),this.wrapper&&this.wrapperObserver.observe(this.wrapper),this.container&&this.containerObserver.observe(this.container),this.svgComputedStyle&&this.observeSVGStyle(this.svgComputedStyle)}observeSVGStyle(t){const e=()=>{const i=(()=>{const e=t.getPropertyValue("--preserve-aspect-ratio");if(e)return e.trim();return`x${(({textAlign:t,direction:e})=>{if(t.endsWith("left"))return"Min";if(t.endsWith("right"))return"Max";if("start"===t||"end"===t){let i="rtl"===e;return"end"===t&&(i=!i),i?"Max":"Min"}return"Mid"})(t)}YMid meet`})();i!==this.svgPreserveAspectRatio&&(this.svgPreserveAspectRatio=i,this.updateSVGRect()),t===this.svgComputedStyle&&requestAnimationFrame(e)};e()}updateSVGRect(){var t,e,i,n,s,o,r;let a=Math.ceil(null!==(e=null===(t=this.containerSize)||void 0===t?void 0:t.width)&&void 0!==e?e:0);const l=Math.ceil(null!==(n=null===(i=this.containerSize)||void 0===i?void 0:i.height)&&void 0!==n?n:0);void 0!==this.dataset.downscaleOnly&&(a=Math.max(a,null!==(o=null===(s=this.wrapperSize)||void 0===s?void 0:s.width)&&void 0!==o?o:0));const c=null===(r=this.svg)||void 0===r?void 0:r.querySelector(":scope > foreignObject");if(null==c||c.setAttribute("width",`${a}`),null==c||c.setAttribute("height",`${l}`),this.svg&&(this.svg.setAttribute("viewBox",`0 0 ${a} ${l}`),this.svg.setAttribute("preserveAspectRatio",this.svgPreserveAspectRatio),this.svg.style.height=a<=0||l<=0?"0":""),this.container){const t=this.svgPreserveAspectRatio.toLowerCase();this.container.style.marginLeft=t.startsWith("xmid")||t.startsWith("xmax")?"auto":"0",this.container.style.marginRight=t.startsWith("xmi")?"auto":"0"}}}const o=(t,{attrs:e={},style:i})=>class extends t{constructor(...t){super(...t);for(const[t,i]of Object.entries(e))this.hasAttribute(t)||this.setAttribute(t,i);this.attachShadow({mode:"open"})}static get observedAttributes(){return["data-auto-scaling"]}connectedCallback(){this._update()}attributeChangedCallback(){this._update()}_update(){const t=i?`<style>:host { ${i} }</style>`:"";let e="<slot></slot>";const{autoScaling:n}=this.dataset;if(void 0!==n){e=`<marp-auto-scaling exportparts="svg:auto-scaling" ${"downscale-only"===n?"data-downscale-only":""}>${e}</marp-auto-scaling>`}this.shadowRoot.innerHTML=t+e}};let r;const a=Symbol(),l="marpitSVGPolyfill:setZoomFactor,",c=Symbol();let d,p;function h(t){const e="object"==typeof t&&t.target||document,i="object"==typeof t?t.zoom:t;window[c]||(Object.defineProperty(window,c,{configurable:!0,value:!0}),window.addEventListener("message",(({data:t,origin:e})=>{if(e===window.origin)try{if(t&&"string"==typeof t&&t.startsWith(l)){const[,e]=t.split(","),i=Number.parseFloat(e);Number.isNaN(i)||(p=i)}}catch(t){console.error(t)}})));let n=!1;Array.from(e.querySelectorAll("svg[data-marpit-svg]"),(t=>{var e,s,o,r;t.style.transform||(t.style.transform="translateZ(0)");const a=i||p||t.currentScale||1;d!==a&&(d=a,n=a);const l=t.getBoundingClientRect(),{length:c}=t.children;for(let i=0;i<c;i+=1){const n=t.children[i];if(n.getScreenCTM){const t=n.getScreenCTM();if(t){const i=null!==(s=null===(e=n.x)||void 0===e?void 0:e.baseVal.value)&&void 0!==s?s:0,c=null!==(r=null===(o=n.y)||void 0===o?void 0:o.baseVal.value)&&void 0!==r?r:0,d=n.children.length;for(let e=0;e<d;e+=1){const s=n.children[e];if("SECTION"===s.tagName){const{style:e}=s;e.transformOrigin||(e.transformOrigin=`${-i}px ${-c}px`),e.transform=`scale(${a}) matrix(${t.a}, ${t.b}, ${t.c}, ${t.d}, ${t.e-l.left}, ${t.f-l.top}) translateZ(0.0001px)`;break}}}}}})),!1!==n&&Array.from(e.querySelectorAll("iframe"),(({contentWindow:t})=>{null==t||t.postMessage(`${l}${n}`,"null"===window.origin?"*":window.origin)}))}function g({once:t=!1,target:e=document}={}){const i="Apple Computer, Inc."===navigator.vendor?[h]:[];let n=!t;const s=()=>{for(const t of i)t({target:e});n&&window.requestAnimationFrame(s)};return s(),()=>{n=!1}}d=1,p=void 0;const m=Symbol(),v=(e=document)=>{if("undefined"==typeof window)throw new Error("Marp Core's browser script is valid only in browser context.");if(((e=document)=>{const i=window[a];i||customElements.define("marp-auto-scaling",s);for(const n of Object.keys(t)){const s=`marp-${n}`,a=t[n].proto();null!=r||(r=!!document.createElement("div",{is:"marp-auto-scaling"}).outerHTML.startsWith("<div is")),r&&a!==HTMLElement?i||customElements.define(s,o(a,{style:t[n].style}),{extends:n}):(i||customElements.define(s,o(HTMLElement,t[n])),e.querySelectorAll(`${n}[is="${s}"]`).forEach((t=>{t.outerHTML=t.outerHTML.replace(new RegExp(`^<${n}`,"i"),`<${s}`).replace(new RegExp(`</${n}>$`,"i"),`</${s}>`)})))}window[a]=!0})(e),e[m])return e[m];const i=g({target:e}),n=()=>{i(),delete e[m]},l=Object.assign(n,{cleanup:n,update:()=>v(e)});return Object.defineProperty(e,m,{configurable:!0,value:l}),l},u=document.currentScript;v(u?u.getRootNode():document)}();
</script></foreignObject></svg></div><div class="bespoke-marp-note" data-index="4" tabindex="0"><p>Scoped style</p></div><div class="bespoke-marp-note" data-index="12" tabindex="0"><p>```c++
   send_ioctl(cmd::process_data, data, [&amp;](const buffer&amp; response)
   {
      ...
      if (is_important)
      {
        send_ioctl(cmd::encrypt_data, response, [&amp;](const buffer&amp; encrypted)
        {
          on_data_encrypted(encrypted));
        }
      }
   });
```</p></div><div class="bespoke-marp-note" data-index="18" tabindex="0"><p>Compiler to compile the function as a coroutine rather than as a normal function.</p></div><div class="bespoke-marp-note" data-index="20" tabindex="0"><p>This is all we have in the language regarding coroutines.</p></div><div class="bespoke-marp-note" data-index="23" tabindex="0"><p>coroutine_handle is passed to await_suspend, awaiter can resume coroutine in continuation-passing style</p></div><div class="bespoke-marp-note" data-index="28" tabindex="0"><p>We may also return my_awaitable here.</p></div><div class="bespoke-marp-note" data-index="29" tabindex="0"><p>&lt;return-to-caller&gt; - coroutine is suspended and execution is returned to caller. Caller must caller `resume()` on coroutine_handle to resume execution of coroutine at &lt;resume-point&gt;.
handle - handle of coroutine where co_await is being expanded
await_suspend - can also return void, in that case coroutine is always suspended
await_suspend - used to perform some logic just before suspension of coroutine</p></div><div class="bespoke-marp-note" data-index="30" tabindex="0"><p>Possibility to execute code after coroutine is suspended but before execution is returned to caller.
Rest of the coroutine is executed where the resume() is called.</p></div><div class="bespoke-marp-note" data-index="31" tabindex="0"><p>from_promise - static method, used by compiler
address(), from_address() - passing coroutine to C interfaces as a context parameter
coroutine_handle can be obtained in two ways:
1. passed to the await_suspend() method during a co_await expression.
2. using static method from_promise (if promise is available)</p></div><div class="bespoke-marp-note" data-index="32" tabindex="0"><p>There is no way to distinguish coroutine by it's prototype, only by looking
at implementation. The fact that function is coroutine is implementation detail.</p></div><div class="bespoke-marp-note" data-index="36" tabindex="0"><p>initial_suspend and final_suspend is outside of try-catch block. Exception will propagate to the caller.
Return of both initial_suspend and final_suspend is discarded. awaiter should return void in both of these cases.
Exception can be re-thrown directly (will cause destruction of coroutine frame) or later in appropriate context.</p></div><div class="bespoke-marp-note" data-index="39" tabindex="0"><p>Dynamic allocation because the coroutine loses use of the stack when it is suspended.
Customization by defining operators new and delete on promise type.

Optimization can happen if compiler is able to prove that lifetime of the coroutine frame is strictly nested within the lifetime of the caller (possibly common scenario).</p></div><div class="bespoke-marp-note" data-index="42" tabindex="0"><p>If coroutine reaches the end without co_return this is equal to return_void .
return_* requirement depends on the use of co_return inside coroutine.
Coroutine can contain only one of these.</p></div><div class="bespoke-marp-note" data-index="43" tabindex="0"><p>Resuming coroutine suspend on final suspend leads to undefined behavior.</p></div><div class="bespoke-marp-note" data-index="44" tabindex="0"><p>Providing promise_type for types over which we don't have control
template &lt;typename T, typename... ARGS&gt;
struct std::coroutine_traits&lt;std::future&lt;T&gt;, ARGS...&gt;
{
  struct promise_type {...}
}</p></div><div class="bespoke-marp-note" data-index="49" tabindex="0"><p>Coroutine starts executing immediately.</p></div><div class="bespoke-marp-note" data-index="50" tabindex="0"><p>Compiled as coroutine because of co_yield.
my_coroutine must be implemented by us. It is an interface that we provide to caller.</p></div><div class="bespoke-marp-note" data-index="55" tabindex="0"><p>// First schedule the coroutine onto the threadpool.
    // When it resumes, this coroutine is now running on the threadpool.</p></div><div class="bespoke-marp-note" data-index="63" tabindex="0"><p>Making task awaitable on r-value of task instance by adding co_await operator.</p></div><div class="bespoke-marp-note" data-index="64" tabindex="0"><p>final_awaiter must resume the coroutine of caller</p></div><script>/*!! License: https://unpkg.com/@marp-team/marp-cli@2.2.0/lib/bespoke.js.LICENSE.txt */
!function(){"use strict";"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;const e=document.body,t=(...e)=>history.replaceState(...e),n="presenter",r="next",o=["",n,r],a="data-bespoke-marp-",i=(e,{protocol:t,host:n,pathname:r,hash:o}=location)=>{const a=e.toString();return`${t}//${n}${r}${a?"?":""}${a}${o}`},s=()=>e.dataset.bespokeView,l=e=>new URLSearchParams(location.search).get(e),c=(e,n={})=>{var r;const o={location,setter:t,...n},a=new URLSearchParams(o.location.search);for(const t of Object.keys(e)){const n=e[t];"string"==typeof n?a.set(t,n):a.delete(t)}try{o.setter({...null!==(r=window.history.state)&&void 0!==r?r:{}},"",i(a,o.location))}catch(e){console.error(e)}},d=(()=>{const e="bespoke-marp";try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}})(),u=e=>{try{return localStorage.getItem(e)}catch(e){return null}},f=(e,t)=>{try{return localStorage.setItem(e,t),!0}catch(e){return!1}},m=e=>{try{return localStorage.removeItem(e),!0}catch(e){return!1}},g=(e,t)=>{const n="aria-hidden";t?e.setAttribute(n,"true"):e.removeAttribute(n)},p=e=>{e.parent.classList.add("bespoke-marp-parent"),e.slides.forEach((e=>e.classList.add("bespoke-marp-slide"))),e.on("activate",(t=>{const n="bespoke-marp-active",r=t.slide,o=r.classList,a=!o.contains(n);if(e.slides.forEach((e=>{e.classList.remove(n),g(e,!0)})),o.add(n),g(r,!1),a){const e=`${n}-ready`;o.add(e),document.body.clientHeight,o.remove(e)}}))},v=e=>{let t=0,n=0;Object.defineProperty(e,"fragments",{enumerable:!0,value:e.slides.map((e=>[null,...e.querySelectorAll("[data-marpit-fragment]")]))});const r=r=>void 0!==e.fragments[t][n+r],o=(r,o)=>{t=r,n=o,e.fragments.forEach(((e,t)=>{e.forEach(((e,n)=>{if(null==e)return;const i=t<r||t===r&&n<=o;e.setAttribute(`${a}fragment`,(i?"":"in")+"active");const s=`${a}current-fragment`;t===r&&n===o?e.setAttribute(s,"current"):e.removeAttribute(s)}))})),e.fragmentIndex=o;const i={slide:e.slides[r],index:r,fragments:e.fragments[r],fragmentIndex:o};e.fire("fragment",i)};e.on("next",(({fragment:a=!0})=>{if(a){if(r(1))return o(t,n+1),!1;const a=t+1;e.fragments[a]&&o(a,0)}else{const r=e.fragments[t].length;if(n+1<r)return o(t,r-1),!1;const a=e.fragments[t+1];a&&o(t+1,a.length-1)}})),e.on("prev",(({fragment:a=!0})=>{if(r(-1)&&a)return o(t,n-1),!1;const i=t-1;e.fragments[i]&&o(i,e.fragments[i].length-1)})),e.on("slide",(({index:t,fragment:n})=>{let r=0;if(void 0!==n){const o=e.fragments[t];if(o){const{length:e}=o;r=-1===n?e-1:Math.min(Math.max(n,0),e-1)}}o(t,r)})),o(0,0)},h=document,y=()=>!(!h.fullscreenEnabled&&!h.webkitFullscreenEnabled),b=()=>!(!h.fullscreenElement&&!h.webkitFullscreenElement),w=e=>{e.fullscreen=()=>{y()&&(async()=>{return b()?null===(e=h.exitFullscreen||h.webkitExitFullscreen)||void 0===e?void 0:e.call(h):((e=h.body)=>{var t;return null===(t=e.requestFullscreen||e.webkitRequestFullscreen)||void 0===t?void 0:t.call(e)})();var e})()},document.addEventListener("keydown",(t=>{"f"!==t.key&&"F11"!==t.key||t.altKey||t.ctrlKey||t.metaKey||!y()||(e.fullscreen(),t.preventDefault())}))},x="bespoke-marp-inactive",k=(e=2e3)=>({parent:t,fire:n})=>{const r=t.classList,o=e=>n(`marp-${e?"":"in"}active`);let a;const i=()=>{a&&clearTimeout(a),a=setTimeout((()=>{r.add(x),o()}),e),r.contains(x)&&(r.remove(x),o(!0))};for(const e of["mousedown","mousemove","touchend"])document.addEventListener(e,i);setTimeout(i,0)},E=["AUDIO","BUTTON","INPUT","SELECT","TEXTAREA","VIDEO"],$=e=>{e.parent.addEventListener("keydown",(e=>{if(!e.target)return;const t=e.target;(E.includes(t.nodeName)||"true"===t.contentEditable)&&e.stopPropagation()}))},L=e=>{window.addEventListener("load",(()=>{for(const t of e.slides){const e=t.querySelector("marp-auto-scaling, [data-auto-scaling], [data-marp-fitting]");t.setAttribute(`${a}load`,e?"":"hideable")}}))},S=({interval:e=250}={})=>t=>{document.addEventListener("keydown",(e=>{if(" "===e.key&&e.shiftKey)t.prev();else if("ArrowLeft"===e.key||"ArrowUp"===e.key||"PageUp"===e.key)t.prev({fragment:!e.shiftKey});else if(" "!==e.key||e.shiftKey)if("ArrowRight"===e.key||"ArrowDown"===e.key||"PageDown"===e.key)t.next({fragment:!e.shiftKey});else if("End"===e.key)t.slide(t.slides.length-1,{fragment:-1});else{if("Home"!==e.key)return;t.slide(0)}else t.next();e.preventDefault()}));let n,r,o=0;t.parent.addEventListener("wheel",(a=>{let i=!1;const s=(e,t)=>{e&&(i=i||((e,t)=>((e,t)=>{const n="X"===t?"Width":"Height";return e[`client${n}`]<e[`scroll${n}`]})(e,t)&&((e,t)=>{const{overflow:n}=e,r=e[`overflow${t}`];return"auto"===n||"scroll"===n||"auto"===r||"scroll"===r})(getComputedStyle(e),t))(e,t)),(null==e?void 0:e.parentElement)&&s(e.parentElement,t)};if(0!==a.deltaX&&s(a.target,"X"),0!==a.deltaY&&s(a.target,"Y"),i)return;a.preventDefault();const l=Math.sqrt(a.deltaX**2+a.deltaY**2);if(void 0!==a.wheelDelta){if(void 0===a.webkitForce&&Math.abs(a.wheelDelta)<40)return;if(a.deltaMode===a.DOM_DELTA_PIXEL&&l<4)return}else if(a.deltaMode===a.DOM_DELTA_PIXEL&&l<12)return;r&&clearTimeout(r),r=setTimeout((()=>{n=0}),e);const c=Date.now()-o<e,d=l<=n;if(n=l,c||d)return;let u;(a.deltaX>0||a.deltaY>0)&&(u="next"),(a.deltaX<0||a.deltaY<0)&&(u="prev"),u&&(t[u](),o=Date.now())}))},P=(e=".bespoke-marp-osc")=>{const t=document.querySelector(e);if(!t)return()=>{};const n=(e,n)=>{t.querySelectorAll(`[${a}osc=${JSON.stringify(e)}]`).forEach(n)};return y()||n("fullscreen",(e=>e.style.display="none")),d||n("presenter",(e=>{e.disabled=!0,e.title="Presenter view is disabled due to restricted localStorage."})),e=>{t.addEventListener("click",(t=>{if(t.target instanceof HTMLElement){const{bespokeMarpOsc:n}=t.target.dataset;n&&t.target.blur();const r={fragment:!t.shiftKey};"next"===n?e.next(r):"prev"===n?e.prev(r):"fullscreen"===n?null==e||e.fullscreen():"presenter"===n&&e.openPresenterView()}})),e.parent.appendChild(t),e.on("activate",(({index:t})=>{n("page",(n=>n.textContent=`Page ${t+1} of ${e.slides.length}`))})),e.on("fragment",(({index:t,fragments:r,fragmentIndex:o})=>{n("prev",(e=>e.disabled=0===t&&0===o)),n("next",(n=>n.disabled=t===e.slides.length-1&&o===r.length-1))})),e.on("marp-active",(()=>g(t,!1))),e.on("marp-inactive",(()=>g(t,!0))),y()&&(e=>{for(const t of["","webkit"])h.addEventListener(t+"fullscreenchange",e)})((()=>n("fullscreen",(e=>e.classList.toggle("exit",y()&&b())))))}},T=e=>{window.addEventListener("message",(t=>{if(t.origin!==window.origin)return;const[n,r]=t.data.split(":");if("navigate"===n){const[t,n]=r.split(",");let o=Number.parseInt(t,10),a=Number.parseInt(n,10)+1;a>=e.fragments[o].length&&(o+=1,a=0),e.slide(o,{fragment:a})}}))};var _,I,A,M,D,O,C={exports:{}};C.exports=(_=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],I=function(e){return String(e).replace(/[&<>"']/g,(function(e){return"&"+A[e]+";"}))},A={"&":"amp","<":"lt",">":"gt",'"':"quot","'":"apos"},M="dangerouslySetInnerHTML",D={className:"class",htmlFor:"for"},O={},function(e,t){var n=[],r="";t=t||{};for(var o=arguments.length;o-- >2;)n.push(arguments[o]);if("function"==typeof e)return t.children=n.reverse(),e(t);if(e){if(r+="<"+e,t)for(var a in t)!1!==t[a]&&null!=t[a]&&a!==M&&(r+=" "+(D[a]?D[a]:I(a))+'="'+I(t[a])+'"');r+=">"}if(-1===_.indexOf(e)){if(t[M])r+=t[M].__html;else for(;n.length;){var i=n.pop();if(i)if(i.pop)for(var s=i.length;s--;)n.push(i[s]);else r+=!0===O[i]?i:I(i)}r+=e?"</"+e+">":""}return O[r]=!0,r});var N=C.exports;const B=({children:e})=>N(null,null,...e),q="bespoke-marp-presenter-",K={container:`${q}container`,dragbar:`${q}dragbar-container`,next:`${q}next`,nextContainer:`${q}next-container`,noteContainer:`${q}note-container`,noteWrapper:`${q}note-wrapper`,noteButtons:`${q}note-buttons`,infoContainer:`${q}info-container`,infoPage:`${q}info-page`,infoPageText:`${q}info-page-text`,infoPagePrev:`${q}info-page-prev`,infoPageNext:`${q}info-page-next`,noteButtonsBigger:`${q}note-bigger`,noteButtonsSmaller:`${q}note-smaller`,infoTime:`${q}info-time`,infoTimer:`${q}info-timer`},F=e=>{const{title:t}=document;document.title="[Presenter view]"+(t?` - ${t}`:"");const n={},r=e=>(n[e]=n[e]||document.querySelector(`.${e}`),n[e]);document.body.appendChild((e=>{const t=document.createElement("div");return t.className=K.container,t.appendChild(e),t.insertAdjacentHTML("beforeend",N(B,null,N("div",{class:K.nextContainer},N("iframe",{class:K.next,src:"?view=next"})),N("div",{class:K.dragbar}),N("div",{class:K.noteContainer},N("div",{class:K.noteWrapper}),N("div",{class:K.noteButtons},N("button",{class:K.noteButtonsSmaller,tabindex:"-1",title:"Smaller notes font size"},"Smaller notes font size"),N("button",{class:K.noteButtonsBigger,tabindex:"-1",title:"Bigger notes font size"},"Bigger notes font size"))),N("div",{class:K.infoContainer},N("div",{class:K.infoPage},N("button",{class:K.infoPagePrev,tabindex:"-1",title:"Previous"},"Previous"),N("span",{class:K.infoPageText}),N("button",{class:K.infoPageNext,tabindex:"-1",title:"Next"},"Next")),N("time",{class:K.infoTime,title:"Current time"}),N("time",{class:K.infoTimer,title:"Timer"})))),t})(e.parent)),(e=>{let t=!1;r(K.dragbar).addEventListener("mousedown",(()=>{t=!0,r(K.dragbar).classList.add("active")})),window.addEventListener("mouseup",(()=>{t=!1,r(K.dragbar).classList.remove("active")})),window.addEventListener("mousemove",(e=>{if(!t)return;const n=e.clientX/document.documentElement.clientWidth*100;r(K.container).style.setProperty("--bespoke-marp-presenter-split-ratio",`${Math.max(0,Math.min(100,n))}%`)})),r(K.nextContainer).addEventListener("click",(()=>e.next()));const n=r(K.next),o=(a=n,(e,t)=>{var n;return null===(n=a.contentWindow)||void 0===n?void 0:n.postMessage(`navigate:${e},${t}`,"null"===window.origin?"*":window.origin)});var a;n.addEventListener("load",(()=>{r(K.nextContainer).classList.add("active"),o(e.slide(),e.fragmentIndex),e.on("fragment",(({index:e,fragmentIndex:t})=>o(e,t)))}));const i=document.querySelectorAll(".bespoke-marp-note");i.forEach((e=>{e.addEventListener("keydown",(e=>e.stopPropagation())),r(K.noteWrapper).appendChild(e)})),e.on("activate",(()=>i.forEach((t=>t.classList.toggle("active",t.dataset.index==e.slide())))));let s=0;const l=e=>{s=Math.max(-5,s+e),r(K.noteContainer).style.setProperty("--bespoke-marp-note-font-scale",(1.2**s).toFixed(4))},c=()=>l(1),d=()=>l(-1),u=r(K.noteButtonsBigger),f=r(K.noteButtonsSmaller);u.addEventListener("click",(()=>{u.blur(),c()})),f.addEventListener("click",(()=>{f.blur(),d()})),document.addEventListener("keydown",(e=>{"+"===e.key&&c(),"-"===e.key&&d()}),!0),e.on("activate",(({index:t})=>{r(K.infoPageText).textContent=`${t+1} / ${e.slides.length}`}));const m=r(K.infoPagePrev),g=r(K.infoPageNext);m.addEventListener("click",(t=>{m.blur(),e.prev({fragment:!t.shiftKey})})),g.addEventListener("click",(t=>{g.blur(),e.next({fragment:!t.shiftKey})})),e.on("fragment",(({index:t,fragments:n,fragmentIndex:r})=>{m.disabled=0===t&&0===r,g.disabled=t===e.slides.length-1&&r===n.length-1}));let p=new Date;const v=()=>{const e=new Date,t=e=>`${Math.floor(e)}`.padStart(2,"0"),n=e.getTime()-p.getTime(),o=t(n/1e3%60),a=t(n/1e3/60%60),i=t(n/36e5%24);r(K.infoTime).textContent=e.toLocaleTimeString(),r(K.infoTimer).textContent=`${i}:${a}:${o}`};v(),setInterval(v,250),r(K.infoTimer).addEventListener("click",(()=>{p=new Date}))})(e)},j=e=>{if(!(e=>e.syncKey&&"string"==typeof e.syncKey)(e))throw new Error("The current instance of Bespoke.js is invalid for Marp bespoke presenter plugin.");Object.defineProperties(e,{openPresenterView:{enumerable:!0,value:U},presenterUrl:{enumerable:!0,get:V}}),d&&document.addEventListener("keydown",(t=>{"p"!==t.key||t.altKey||t.ctrlKey||t.metaKey||(t.preventDefault(),e.openPresenterView())}))};function U(){const{max:e,floor:t}=Math,n=e(t(.85*window.innerWidth),640),r=e(t(.85*window.innerHeight),360);return window.open(this.presenterUrl,q+this.syncKey,`width=${n},height=${r},menubar=no,toolbar=no`)}function V(){const e=new URLSearchParams(location.search);return e.set("view","presenter"),e.set("sync",this.syncKey),i(e)}const X=e=>{const t=s();return t===r&&e.appendChild(document.createElement("span")),{"":j,[n]:F,[r]:T}[t]},H=e=>{e.on("activate",(t=>{document.querySelectorAll(".bespoke-progress-parent > .bespoke-progress-bar").forEach((n=>{n.style.flexBasis=100*t.index/(e.slides.length-1)+"%"}))}))},R=e=>{const t=Number.parseInt(e,10);return Number.isNaN(t)?null:t},W=(e={})=>{const t={history:!0,...e};return e=>{let n=!0;const r=e=>{const t=n;try{return n=!0,e()}finally{n=t}},o=(t={fragment:!0})=>{((t,n)=>{const{min:r,max:o}=Math,{fragments:a,slides:i}=e,s=o(0,r(t,i.length-1)),l=o(0,r(n||0,a[s].length-1));s===e.slide()&&l===e.fragmentIndex||e.slide(s,{fragment:l})})((R(location.hash.slice(1))||1)-1,t.fragment?R(l("f")||""):null)};e.on("fragment",(({index:e,fragmentIndex:r})=>{n||c({f:0===r||r.toString()},{location:{...location,hash:`#${e+1}`},setter:(...e)=>t.history?history.pushState(...e):history.replaceState(...e)})})),setTimeout((()=>{o(),window.addEventListener("hashchange",(()=>r((()=>{o({fragment:!1}),c({f:void 0})})))),window.addEventListener("popstate",(()=>{n||r((()=>o()))})),n=!1}),0)}},J=(e={})=>{var n;const r=e.key||(null===(n=window.history.state)||void 0===n?void 0:n.marpBespokeSyncKey)||Math.random().toString(36).slice(2),o=`bespoke-marp-sync-${r}`;var a;a={marpBespokeSyncKey:r},c({},{setter:(e,...n)=>t({...e,...a},...n)});const i=()=>{const e=u(o);return e?JSON.parse(e):Object.create(null)},s=e=>{const t=i(),n={...t,...e(t)};return f(o,JSON.stringify(n)),n},l=()=>{window.removeEventListener("pageshow",l),s((e=>({reference:(e.reference||0)+1})))};return e=>{l(),Object.defineProperty(e,"syncKey",{value:r,enumerable:!0});let t=!0;setTimeout((()=>{e.on("fragment",(e=>{t&&s((()=>({index:e.index,fragmentIndex:e.fragmentIndex})))}))}),0),window.addEventListener("storage",(n=>{if(n.key===o&&n.oldValue&&n.newValue){const r=JSON.parse(n.oldValue),o=JSON.parse(n.newValue);if(r.index!==o.index||r.fragmentIndex!==o.fragmentIndex)try{t=!1,e.slide(o.index,{fragment:o.fragmentIndex,forSync:!0})}finally{t=!0}}}));const n=()=>{const{reference:e}=i();void 0===e||e<=1?m(o):s((()=>({reference:e-1})))};window.addEventListener("pagehide",(e=>{e.persisted&&window.addEventListener("pageshow",l),n()})),e.on("destroy",n)}},{PI:Y,abs:z,sqrt:G,atan2:Q}=Math,Z={passive:!0},ee=({slope:e=-.7,swipeThreshold:t=30}={})=>n=>{let r;const o=n.parent,a=e=>{const t=o.getBoundingClientRect();return{x:e.pageX-(t.left+t.right)/2,y:e.pageY-(t.top+t.bottom)/2}};o.addEventListener("touchstart",(({touches:e})=>{r=1===e.length?a(e[0]):void 0}),Z),o.addEventListener("touchmove",(e=>{if(r)if(1===e.touches.length){e.preventDefault();const t=a(e.touches[0]),n=t.x-r.x,o=t.y-r.y;r.delta=G(z(n)**2+z(o)**2),r.radian=Q(n,o)}else r=void 0})),o.addEventListener("touchend",(o=>{if(r){if(r.delta&&r.delta>=t&&r.radian){const t=(r.radian-e+Y)%(2*Y)-Y;n[t<0?"next":"prev"](),o.stopPropagation()}r=void 0}}),Z)},te=new Map;te.clear(),te.set("none",{backward:{both:void 0,incoming:void 0,outgoing:void 0},forward:{both:void 0,incoming:void 0,outgoing:void 0}});const ne={both:"",outgoing:"outgoing-",incoming:"incoming-"},re={forward:"",backward:"-backward"},oe=e=>`--marp-bespoke-transition-animation-${e}`,ae=e=>`--marp-transition-${e}`,ie=oe("name"),se=oe("duration"),le=e=>new Promise((t=>{const n={},r=document.createElement("div"),o=e=>{r.remove(),t(e)};r.addEventListener("animationstart",(()=>o(n))),Object.assign(r.style,{animationName:e,animationDuration:"1s",animationFillMode:"both",animationPlayState:"paused",position:"absolute",pointerEvents:"none"}),document.body.appendChild(r);const a=getComputedStyle(r).getPropertyValue(ae("duration"));a&&(n.defaultDuration=a),((e,t)=>{requestAnimationFrame((()=>{e.style.animationPlayState="running",requestAnimationFrame((()=>t(void 0)))}))})(r,o)})),ce=async e=>te.has(e)?te.get(e):(e=>{const t={},n=[];for(const[r,o]of Object.entries(ne))for(const[a,i]of Object.entries(re)){const s=`marp-${o}transition${i}-${e}`;n.push(le(s).then((e=>{t[a]=t[a]||{},t[a][r]=e?{...e,name:s}:void 0})))}return Promise.all(n).then((()=>t))})(e).then((t=>(te.set(e,t),t))),de=e=>Object.values(e).flatMap(Object.values).every((e=>!e)),ue=(e,{type:t,backward:n})=>{const r=e[n?"backward":"forward"],o=(()=>{const e=r[t],n=e=>({[ie]:e.name});if(e)return n(e);if(r.both){const e=n(r.both);return"incoming"===t&&(e[oe("direction")]="reverse"),e}})();return!o&&n?ue(e,{type:t,backward:!1}):o||{[ie]:"__bespoke_marp_transition_no_animation__"}},fe=e=>{if(e)try{const t=JSON.parse(e);if((e=>{if("object"!=typeof e)return!1;const t=e;return"string"==typeof t.name&&(void 0===t.duration||"string"==typeof t.duration)})(t))return t}catch(e){}},me="_tSId",ge="_tA",pe="bespoke-marp-transition-warming-up",ve=window.matchMedia("(prefers-reduced-motion: reduce)"),he="__bespoke_marp_transition_reduced_outgoing__",ye="__bespoke_marp_transition_reduced_incoming__",be={forward:{both:void 0,incoming:{name:ye},outgoing:{name:he}},backward:{both:void 0,incoming:{name:ye},outgoing:{name:he}}},we=e=>{if(!document.createDocumentTransition)return;const t=t=>(void 0!==t&&(e._tD=t),e._tD);let n;t(!1);const r=(e,n)=>{requestAnimationFrame((async()=>{t(e);try{await n()}catch(e){console.warn(e)}finally{t(!1)}}))};((...e)=>{const t=[...new Set(e).values()];return Promise.all(t.map((e=>ce(e)))).then()})(...Array.from(document.querySelectorAll("section[data-transition], section[data-transition-back]")).flatMap((e=>[e.dataset.transition,e.dataset.transitionBack].flatMap((e=>{const t=fe(e);return[null==t?void 0:t.name,(null==t?void 0:t.builtinFallback)?`__builtin__${t.name}`:void 0]})).filter((e=>!!e))))).then((()=>{document.querySelectorAll("style").forEach((e=>{e.innerHTML=e.innerHTML.replace(/--marp-transition-duration:[^;}]*[;}]/g,(e=>e.slice(0,-1)+"!important"+e.slice(-1)))}))}));const o=(n,{back:o,cond:a})=>i=>{var s;const l=t();if(l)return!!i._tA||!("object"!=typeof l||(l.abandon(),!i.forSync));if(!a(i))return!0;const c=e.slides[e.slide()],d=()=>{var e;return null!==(e=i.back)&&void 0!==e?e:o},u="data-transition"+(d()?"-back":""),f=c.querySelector(`section[${u}]`);if(!f)return!0;const m=fe(null!==(s=f.getAttribute(u))&&void 0!==s?s:void 0);return!m||((async(e,{builtinFallback:t=!0}={})=>{let n=await ce(e);if(de(n)){if(!t)return;return n=await ce(`__builtin__${e}`),de(n)?void 0:n}return n})(m.name,{builtinFallback:m.builtinFallback}).then((e=>{if(!e)return r(!0,(()=>n(i)));let o=e;ve.matches&&(console.warn("Use a constant animation to transition because preferring reduced motion by viewer has detected. "),o=be);const a=document.getElementById(me);a&&a.remove();const s=document.createElement("style");s.id=me,document.head.appendChild(s),((e,t)=>{const n=[`:root{${ae("direction")}:${t.backward?-1:1};}`],r=t=>{var n,o,a;const i=(null===(n=e[t].both)||void 0===n?void 0:n.defaultDuration)||(null===(o=e[t].outgoing)||void 0===o?void 0:o.defaultDuration)||(null===(a=e[t].incoming)||void 0===a?void 0:a.defaultDuration);return"forward"===t?i:i||r("forward")},o=t.duration||r(t.backward?"backward":"forward");void 0!==o&&n.push(`::page-transition-container(*){${se}:${o};}`);const a=e=>Object.entries(e).map((([e,t])=>`${e}:${t};`)).join("");return n.push(`::page-transition-outgoing-image(root){${a(ue(e,{...t,type:"outgoing"}))}}`,`::page-transition-incoming-image(root){${a(ue(e,{...t,type:"incoming"}))}}`),n})(o,{backward:d(),duration:m.duration}).forEach((e=>{var t;return null===(t=s.sheet)||void 0===t?void 0:t.insertRule(e)}));try{const e=document.createDocumentTransition(),t=document.documentElement.classList;t.add(pe);let o=!1;const a=()=>{o||(n(i),o=!0,t.remove(pe))};r(e,(async()=>{try{await e.start(a)}catch(e){console.error(e),a()}finally{s.remove(),t.remove(pe)}}))}catch(e){t(!1)}})),!1)};e.on("prev",o((t=>e.prev({...t,[ge]:!0})),{back:!0,cond:e=>{var t;return e.index>0&&!((null===(t=e.fragment)||void 0===t||t)&&n.fragmentIndex>0)}})),e.on("next",o((t=>e.next({...t,[ge]:!0})),{cond:t=>t.index+1<e.slides.length&&!(n.fragmentIndex+1<n.fragments.length)})),setTimeout((()=>{e.on("slide",o((t=>e.slide(t.index,{...t,[ge]:!0})),{cond:t=>{const n=e.slide();return t.index!==n&&(t.back=t.index<n,!0)}}))}),0),e.on("fragment",(e=>{n=e}))};let xe;const ke=()=>(void 0===xe&&(xe="wakeLock"in navigator&&navigator.wakeLock),xe),Ee=async()=>{const e=ke();if(e)try{return await e.request("screen")}catch(e){console.warn(e)}return null},$e=async()=>{if(!ke())return;let e;const t=()=>{e&&"visible"===document.visibilityState&&Ee()};for(const e of["visibilitychange","fullscreenchange"])document.addEventListener(e,t);return e=await Ee(),e};((t=document.getElementById("p"))=>{(()=>{const t=l("view");e.dataset.bespokeView=t===r||t===n?t:""})();const a=(e=>{const t=l(e);return c({[e]:void 0}),t})("sync")||void 0;var i,d,u,f,m,g,h,y,b,x,E,T;i=t,d=((...e)=>{const t=o.findIndex((e=>s()===e));return e.map((([e,n])=>e[t]&&n)).filter((e=>e))})([[1,1,0],J({key:a})],[[1,1,1],X(t)],[[1,1,0],$],[[1,1,1],p],[[1,0,0],k()],[[1,1,1],L],[[1,1,1],W({history:!1})],[[1,1,0],S()],[[1,1,0],w],[[1,0,0],H],[[1,1,0],ee()],[[1,0,0],P()],[[1,0,0],we],[[1,1,1],v],[[1,1,0],$e]),f=1===(i.parent||i).nodeType?i.parent||i:document.querySelector(i.parent||i),m=[].filter.call("string"==typeof i.slides?f.querySelectorAll(i.slides):i.slides||f.children,(function(e){return"SCRIPT"!==e.nodeName})),g={},h=function(e,t){return(t=t||{}).index=m.indexOf(e),t.slide=e,t},x=function(e,t){m[e]&&(u&&b("deactivate",h(u,t)),u=m[e],b("activate",h(u,t)))},E=function(e,t){var n=m.indexOf(u)+e;b(e>0?"next":"prev",h(u,t))&&x(n,t)},T={off:y=function(e,t){g[e]=(g[e]||[]).filter((function(e){return e!==t}))},on:function(e,t){return(g[e]||(g[e]=[])).push(t),y.bind(null,e,t)},fire:b=function(e,t){return(g[e]||[]).reduce((function(e,n){return e&&!1!==n(t)}),!0)},slide:function(e,t){if(!arguments.length)return m.indexOf(u);b("slide",h(m[e],t))&&x(e,t)},next:E.bind(null,1),prev:E.bind(null,-1),parent:f,slides:m,destroy:function(e){b("destroy",h(u,e)),g={}}},(d||[]).forEach((function(e){e(T)})),u||x(0)})()}();</script></body></html>